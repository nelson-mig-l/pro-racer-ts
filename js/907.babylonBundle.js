"use strict";(self.webpackChunkpro_racer=self.webpackChunkpro_racer||[]).push([[907],{7759:(t,s,e)=>{e.d(s,{b:()=>d});var o=e(972),i=e(9288),n=e(9635),r=e(7504),a=e(7959),h=e(4517),c=e(9590),m=e(1528),p=e(5388),l=e(1865),y=e(7786);class d{constructor(t=!0,s=Ammo,e=null){this._useDeltaForWorldStep=t,this.bjsAMMO={},this.name="AmmoJSPlugin",this._timeStep=1/60,this._fixedTimeStep=1/60,this._maxSteps=5,this._tmpQuaternion=new o._f,this._tmpContactCallbackResult=!1,this._tmpContactPoint=new o.P,this._tmpContactNormal=new o.P,this._tmpVec3=new o.P,this._tmpMatrix=new o.y3,"function"!=typeof s?(this.bjsAMMO=s,this.isSupported()?(this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration,this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=e||new this.bjsAMMO.btDbvtBroadphase,this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver,this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver,this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback,this._tmpAmmoConcreteContactResultCallback.addSingleResult=t=>{const s=(t=this.bjsAMMO.wrapPointer(t,this.bjsAMMO.btManifoldPoint)).getPositionWorldOnA(),e=t.m_normalWorldOnB;this._tmpContactPoint.x=s.x(),this._tmpContactPoint.y=s.y(),this._tmpContactPoint.z=s.z(),this._tmpContactNormal.x=e.x(),this._tmpContactNormal.y=e.y(),this._tmpContactNormal.z=e.z(),this._tmpContactImpulse=t.getAppliedImpulse(),this._tmpContactDistance=t.getDistance(),this._tmpContactCallbackResult=!0},this._raycastResult=new p.d,this._tmpAmmoTransform=new this.bjsAMMO.btTransform,this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)):i.Y.Error("AmmoJS is not available. Please make sure you included the js file.")):i.Y.Error("AmmoJS is not ready. Please make sure you await Ammo() before using the plugin.")}setGravity(t){this._tmpAmmoVectorA.setValue(t.x,t.y,t.z),this.world.setGravity(this._tmpAmmoVectorA),this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)}setTimeStep(t){this._timeStep=t}setFixedTimeStep(t){this._fixedTimeStep=t}setMaxSteps(t){this._maxSteps=t}getTimeStep(){return this._timeStep}_isImpostorInContact(t){return this._tmpContactCallbackResult=!1,this.world.contactTest(t.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult}_isImpostorPairInContact(t,s){return this._tmpContactCallbackResult=!1,this.world.contactPairTest(t.physicsBody,s.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult}_stepSimulation(t=1/60,s=10,e=1/60){if(0==s)this.world.stepSimulation(t,0);else for(;s>0&&t>0;)t-e<e?(this.world.stepSimulation(t,0),t=0):(t-=e,this.world.stepSimulation(e,0)),s--}executeStep(t,s){for(const t of s)t.soft||t.beforeStep();this._stepSimulation(this._useDeltaForWorldStep?t:this._timeStep,this._maxSteps,this._fixedTimeStep);for(const t of s)if(t.soft?this._afterSoftStep(t):t.afterStep(),t._onPhysicsCollideCallbacks.length>0&&this._isImpostorInContact(t))for(const s of t._onPhysicsCollideCallbacks)for(const e of s.otherImpostors)(t.physicsBody.isActive()||e.physicsBody.isActive())&&this._isImpostorPairInContact(t,e)&&(t.onCollide({body:e.physicsBody,point:this._tmpContactPoint,distance:this._tmpContactDistance,impulse:this._tmpContactImpulse,normal:this._tmpContactNormal}),e.onCollide({body:t.physicsBody,point:this._tmpContactPoint,distance:this._tmpContactDistance,impulse:this._tmpContactImpulse,normal:this._tmpContactNormal}))}_afterSoftStep(t){t.type===n.Q.RopeImpostor?this._ropeStep(t):this._softbodyOrClothStep(t)}_ropeStep(t){const s=t.physicsBody.get_m_nodes(),e=s.size();let i,n,r,a,h;const p=new Array;for(let t=0;t<e;t++)i=s.at(t),n=i.get_m_x(),r=n.x(),a=n.y(),h=n.z(),p.push(new o.P(r,a,h));const l=t.object,y=t.getParam("shape");t._isFromLine?t.object=(0,m.nL)("lines",{points:p,instance:l}):t.object=(0,c.Gc)("ext",{shape:y,path:p,instance:l})}_softbodyOrClothStep(t){const s=t.type===n.Q.ClothImpostor?1:-1,e=t.object;let o=e.getVerticesData(a.o.PositionKind);o||(o=[]);let i=e.getVerticesData(a.o.NormalKind);i||(i=[]);const r=o.length/3,c=t.physicsBody.get_m_nodes();let m,p,l,y,d,_,u,g;for(let t=0;t<r;t++){m=c.at(t),p=m.get_m_x(),l=p.x(),y=p.y(),d=p.z()*s;const e=m.get_m_n();_=e.x(),u=e.y(),g=e.z()*s,o[3*t]=l,o[3*t+1]=y,o[3*t+2]=d,i[3*t]=_,i[3*t+1]=u,i[3*t+2]=g}const b=new h.x;b.positions=o,b.normals=i,b.uvs=e.getVerticesData(a.o.UVKind),b.colors=e.getVerticesData(a.o.ColorKind),e&&e.getIndices&&(b.indices=e.getIndices()),b.applyToMesh(e)}applyImpulse(t,s,e){if(t.soft)i.Y.Warn("Cannot be applied to a soft body");else{t.physicsBody.activate();const o=this._tmpAmmoVectorA,i=this._tmpAmmoVectorB;t.object&&t.object.getWorldMatrix&&e.subtractInPlace(t.object.getWorldMatrix().getTranslation()),o.setValue(e.x,e.y,e.z),i.setValue(s.x,s.y,s.z),t.physicsBody.applyImpulse(i,o)}}applyForce(t,s,e){if(t.soft)i.Y.Warn("Cannot be applied to a soft body");else{t.physicsBody.activate();const o=this._tmpAmmoVectorA,i=this._tmpAmmoVectorB;if(t.object&&t.object.getWorldMatrix){const s=t.object.getWorldMatrix().getTranslation();o.setValue(e.x-s.x,e.y-s.y,e.z-s.z)}else o.setValue(e.x,e.y,e.z);i.setValue(s.x,s.y,s.z),t.physicsBody.applyForce(i,o)}}generatePhysicsBody(t){if(t._pluginData.toDispose=[],t.parent)t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());else if(t.isBodyInitRequired()){const s=this._createShape(t),e=t.getParam("mass");if(t._pluginData.mass=e,t.soft)s.get_m_cfg().set_collisions(17),s.get_m_cfg().set_kDP(t.getParam("damping")),this.bjsAMMO.castObject(s,this.bjsAMMO.btCollisionObject).getCollisionShape().setMargin(t.getParam("margin")),s.setActivationState(d._DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(s,1,-1),t.physicsBody=s,t._pluginData.toDispose.push(s),this.setBodyPressure(t,0),t.type===n.Q.SoftbodyImpostor&&this.setBodyPressure(t,t.getParam("pressure")),this.setBodyStiffness(t,t.getParam("stiffness")),this.setBodyVelocityIterations(t,t.getParam("velocityIterations")),this.setBodyPositionIterations(t,t.getParam("positionIterations"));else{const o=new this.bjsAMMO.btVector3(0,0,0),i=new this.bjsAMMO.btTransform;t.object.computeWorldMatrix(!0),i.setIdentity(),0!==e&&s.calculateLocalInertia(e,o),this._tmpAmmoVectorA.setValue(t.object.position.x,t.object.position.y,t.object.position.z),this._tmpAmmoQuaternion.setValue(t.object.rotationQuaternion.x,t.object.rotationQuaternion.y,t.object.rotationQuaternion.z,t.object.rotationQuaternion.w),i.setOrigin(this._tmpAmmoVectorA),i.setRotation(this._tmpAmmoQuaternion);const r=new this.bjsAMMO.btDefaultMotionState(i),a=new this.bjsAMMO.btRigidBodyConstructionInfo(e,r,s,o),h=new this.bjsAMMO.btRigidBody(a);if(0===e&&(h.setCollisionFlags(h.getCollisionFlags()|d._KINEMATIC_FLAG),h.setActivationState(d._DISABLE_DEACTIVATION_FLAG)),t.type!=n.Q.NoImpostor||s.getChildShape||h.setCollisionFlags(h.getCollisionFlags()|d._DISABLE_COLLISION_FLAG),t.type!==n.Q.MeshImpostor&&t.type!==n.Q.NoImpostor){const s=t.object.getBoundingInfo();this._tmpVec3.copyFrom(t.object.getAbsolutePosition()),this._tmpVec3.subtractInPlace(s.boundingBox.centerWorld),this._tmpVec3.x/=t.object.scaling.x,this._tmpVec3.y/=t.object.scaling.y,this._tmpVec3.z/=t.object.scaling.z,t.setDeltaPosition(this._tmpVec3)}const c=t.getParam("group"),m=t.getParam("mask");c&&m?this.world.addRigidBody(h,c,m):this.world.addRigidBody(h),t.physicsBody=h,t._pluginData.toDispose=t._pluginData.toDispose.concat([h,a,r,i,o,s])}this.setBodyRestitution(t,t.getParam("restitution")),this.setBodyFriction(t,t.getParam("friction"))}}removePhysicsBody(t){this.world&&(t.soft?this.world.removeSoftBody(t.physicsBody):this.world.removeRigidBody(t.physicsBody),t._pluginData&&(t._pluginData.toDispose.forEach((t=>{this.bjsAMMO.destroy(t)})),t._pluginData.toDispose=[]))}generateJoint(t){const s=t.mainImpostor.physicsBody,e=t.connectedImpostor.physicsBody;if(!s||!e)return;const n=t.joint.jointData;let a;switch(n.mainPivot||(n.mainPivot=new o.P(0,0,0)),n.connectedPivot||(n.connectedPivot=new o.P(0,0,0)),t.joint.type){case r.q7.DistanceJoint:{const t=n.maxDistance;t&&(n.mainPivot=new o.P(0,-t/2,0),n.connectedPivot=new o.P(0,t/2,0)),a=new this.bjsAMMO.btPoint2PointConstraint(s,e,new this.bjsAMMO.btVector3(n.mainPivot.x,n.mainPivot.y,n.mainPivot.z),new this.bjsAMMO.btVector3(n.connectedPivot.x,n.connectedPivot.y,n.connectedPivot.z));break}case r.q7.HingeJoint:{n.mainAxis||(n.mainAxis=new o.P(0,0,0)),n.connectedAxis||(n.connectedAxis=new o.P(0,0,0));const t=new this.bjsAMMO.btVector3(n.mainAxis.x,n.mainAxis.y,n.mainAxis.z),i=new this.bjsAMMO.btVector3(n.connectedAxis.x,n.connectedAxis.y,n.connectedAxis.z);a=new this.bjsAMMO.btHingeConstraint(s,e,new this.bjsAMMO.btVector3(n.mainPivot.x,n.mainPivot.y,n.mainPivot.z),new this.bjsAMMO.btVector3(n.connectedPivot.x,n.connectedPivot.y,n.connectedPivot.z),t,i);break}case r.q7.BallAndSocketJoint:a=new this.bjsAMMO.btPoint2PointConstraint(s,e,new this.bjsAMMO.btVector3(n.mainPivot.x,n.mainPivot.y,n.mainPivot.z),new this.bjsAMMO.btVector3(n.connectedPivot.x,n.connectedPivot.y,n.connectedPivot.z));break;default:i.Y.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"),a=new this.bjsAMMO.btPoint2PointConstraint(s,e,new this.bjsAMMO.btVector3(n.mainPivot.x,n.mainPivot.y,n.mainPivot.z),new this.bjsAMMO.btVector3(n.connectedPivot.x,n.connectedPivot.y,n.connectedPivot.z))}this.world.addConstraint(a,!t.joint.jointData.collision),t.joint.physicsJoint=a}removeJoint(t){this.world&&this.world.removeConstraint(t.joint.physicsJoint)}_addMeshVerts(t,s,e){let i=0;if(e&&e.getIndices&&e.getWorldMatrix&&e.getChildMeshes){let n=e.getIndices();n||(n=[]);let r,h=e.getVerticesData(a.o.PositionKind);if(h||(h=[]),s&&s!==e){let t;t=s.rotationQuaternion?s.rotationQuaternion:s.rotation?o._f.FromEulerAngles(s.rotation.x,s.rotation.y,s.rotation.z):o._f.Identity(),o.y3.Compose(o.P.One(),t,s.position).invertToRef(this._tmpMatrix),r=e.computeWorldMatrix(!1).multiply(this._tmpMatrix)}else o.y3.ScalingToRef(e.scaling.x,e.scaling.y,e.scaling.z,this._tmpMatrix),r=this._tmpMatrix;const c=n.length/3;for(let s=0;s<c;s++){const e=[];for(let t=0;t<3;t++){let i,a=new o.P(h[3*n[3*s+t]+0],h[3*n[3*s+t]+1],h[3*n[3*s+t]+2]);a=o.P.TransformCoordinates(a,r),i=0==t?this._tmpAmmoVectorA:1==t?this._tmpAmmoVectorB:this._tmpAmmoVectorC,i.setValue(a.x,a.y,a.z),e.push(i)}t.addTriangle(e[0],e[1],e[2]),i++}e.getChildMeshes().forEach((e=>{i+=this._addMeshVerts(t,s,e)}))}return i}_softVertexData(t){const s=t.object;if(s&&s.getIndices&&s.getWorldMatrix&&s.getChildMeshes){let t=s.getIndices();t||(t=[]);let e=s.getVerticesData(a.o.PositionKind);e||(e=[]);let i=s.getVerticesData(a.o.NormalKind);i||(i=[]),s.computeWorldMatrix(!1);const n=[],r=[];for(let t=0;t<e.length;t+=3){let a=new o.P(e[t],e[t+1],e[t+2]),h=new o.P(i[t],i[t+1],i[t+2]);a=o.P.TransformCoordinates(a,s.getWorldMatrix()),h=o.P.TransformNormal(h,s.getWorldMatrix()),n.push(a.x,a.y,a.z),r.push(h.x,h.y,h.z)}const c=new h.x;return c.positions=n,c.normals=r,c.uvs=s.getVerticesData(a.o.UVKind),c.colors=s.getVerticesData(a.o.ColorKind),s&&s.getIndices&&(c.indices=s.getIndices()),c.applyToMesh(s),s.position=o.P.Zero(),s.rotationQuaternion=null,s.rotation=o.P.Zero(),s.computeWorldMatrix(!0),c}return h.x.ExtractFromMesh(s)}_createSoftbody(t){const s=t.object;if(s&&s.getIndices){let e=s.getIndices();e||(e=[]);const i=this._softVertexData(t),n=i.positions,r=i.normals;if(null===n||null===r)return new this.bjsAMMO.btCompoundShape;{const t=[],i=[];for(let s=0;s<n.length;s+=3){const e=new o.P(n[s],n[s+1],n[s+2]),a=new o.P(r[s],r[s+1],r[s+2]);t.push(e.x,e.y,-e.z),i.push(a.x,a.y,-a.z)}const a=(new this.bjsAMMO.btSoftBodyHelpers).CreateFromTriMesh(this.world.getWorldInfo(),t,s.getIndices(),e.length/3,!0),h=n.length/3,c=a.get_m_nodes();let m,p;for(let t=0;t<h;t++)m=c.at(t),p=m.get_m_n(),p.setX(i[3*t]),p.setY(i[3*t+1]),p.setZ(i[3*t+2]);return a}}}_createCloth(t){const s=t.object;if(s&&s.getIndices){let e=s.getIndices();e||(e=[]);const o=this._softVertexData(t),i=o.positions,n=o.normals;if(null===i||null===n)return new this.bjsAMMO.btCompoundShape;{const s=i.length,e=Math.sqrt(s/3);t.segments=e;const o=e-1;return this._tmpAmmoVectorA.setValue(i[0],i[1],i[2]),this._tmpAmmoVectorB.setValue(i[3*o],i[3*o+1],i[3*o+2]),this._tmpAmmoVectorD.setValue(i[s-3],i[s-2],i[s-1]),this._tmpAmmoVectorC.setValue(i[s-3-3*o],i[s-2-3*o],i[s-1-3*o]),(new this.bjsAMMO.btSoftBodyHelpers).CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,e,e,t.getParam("fixedPoints"),!0)}}}_createRope(t){let s,e;const o=this._softVertexData(t),n=o.positions,r=o.normals;if(null===n||null===r)return new this.bjsAMMO.btCompoundShape;if(o.applyToMesh(t.object,!0),t._isFromLine=!0,0===r.map((t=>t*t)).reduce(((t,s)=>t+s)))s=n.length,e=s/3-1,this._tmpAmmoVectorA.setValue(n[0],n[1],n[2]),this._tmpAmmoVectorB.setValue(n[s-3],n[s-2],n[s-1]);else{t._isFromLine=!1;const o=t.getParam("path");if(null===t.getParam("shape"))return i.Y.Warn("No shape available for extruded mesh"),new this.bjsAMMO.btCompoundShape;s=o.length,e=s-1,this._tmpAmmoVectorA.setValue(o[0].x,o[0].y,o[0].z),this._tmpAmmoVectorB.setValue(o[s-1].x,o[s-1].y,o[s-1].z)}t.segments=e;let a=t.getParam("fixedPoints");a=a>3?3:a;const h=(new this.bjsAMMO.btSoftBodyHelpers).CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,e-1,a);return h.get_m_cfg().set_collisions(17),h}_createCustom(t){let s=null;return this.onCreateCustomShape&&(s=this.onCreateCustomShape(t)),null==s&&(s=new this.bjsAMMO.btCompoundShape),s}_addHullVerts(t,s,e){let i=0;if(e&&e.getIndices&&e.getWorldMatrix&&e.getChildMeshes){let n=e.getIndices();n||(n=[]);let r=e.getVerticesData(a.o.PositionKind);r||(r=[]),e.computeWorldMatrix(!1);const h=n.length/3;for(let s=0;s<h;s++){const a=[];for(let t=0;t<3;t++){let i,h=new o.P(r[3*n[3*s+t]+0],r[3*n[3*s+t]+1],r[3*n[3*s+t]+2]);o.y3.ScalingToRef(e.scaling.x,e.scaling.y,e.scaling.z,this._tmpMatrix),h=o.P.TransformCoordinates(h,this._tmpMatrix),i=0==t?this._tmpAmmoVectorA:1==t?this._tmpAmmoVectorB:this._tmpAmmoVectorC,i.setValue(h.x,h.y,h.z),a.push(i)}t.addPoint(a[0],!0),t.addPoint(a[1],!0),t.addPoint(a[2],!0),i++}e.getChildMeshes().forEach((e=>{i+=this._addHullVerts(t,s,e)}))}return i}_createShape(t,s=!1){const e=t.object;let r;const a=t.getObjectExtents();if(!s){const s=t.object.getChildMeshes?t.object.getChildMeshes(!0):[];r=new this.bjsAMMO.btCompoundShape;let e=0;if(s.forEach((t=>{const s=t.getPhysicsImpostor();if(s){if(s.type==n.Q.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";const i=this._createShape(s),a=t.parent.getWorldMatrix().clone(),h=new o.P;a.decompose(h),this._tmpAmmoTransform.getOrigin().setValue(t.position.x*h.x,t.position.y*h.y,t.position.z*h.z),this._tmpAmmoQuaternion.setValue(t.rotationQuaternion.x,t.rotationQuaternion.y,t.rotationQuaternion.z,t.rotationQuaternion.w),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),r.addChildShape(this._tmpAmmoTransform,i),s.dispose(),e++}})),e>0){if(t.type!=n.Q.NoImpostor){const s=this._createShape(t,!0);s&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),r.addChildShape(this._tmpAmmoTransform,s))}return r}this.bjsAMMO.destroy(r),r=null}switch(t.type){case n.Q.SphereImpostor:if(l.R.WithinEpsilon(a.x,a.y,1e-4)&&l.R.WithinEpsilon(a.x,a.z,1e-4))r=new this.bjsAMMO.btSphereShape(a.x/2);else{const t=[new this.bjsAMMO.btVector3(0,0,0)],s=[1];r=new this.bjsAMMO.btMultiSphereShape(t,s,1),r.setLocalScaling(new this.bjsAMMO.btVector3(a.x/2,a.y/2,a.z/2))}break;case n.Q.CapsuleImpostor:{const t=a.x/2;r=new this.bjsAMMO.btCapsuleShape(t,a.y-2*t)}break;case n.Q.CylinderImpostor:this._tmpAmmoVectorA.setValue(a.x/2,a.y/2,a.z/2),r=new this.bjsAMMO.btCylinderShape(this._tmpAmmoVectorA);break;case n.Q.PlaneImpostor:case n.Q.BoxImpostor:this._tmpAmmoVectorA.setValue(a.x/2,a.y/2,a.z/2),r=new this.bjsAMMO.btBoxShape(this._tmpAmmoVectorA);break;case n.Q.MeshImpostor:if(0==t.getParam("mass")){if(this.onCreateCustomMeshImpostor)r=this.onCreateCustomMeshImpostor(t);else{const s=new this.bjsAMMO.btTriangleMesh;t._pluginData.toDispose.push(s);const o=this._addMeshVerts(s,e,e);r=0==o?new this.bjsAMMO.btCompoundShape:new this.bjsAMMO.btBvhTriangleMeshShape(s)}break}case n.Q.ConvexHullImpostor:if(this.onCreateCustomConvexHullImpostor)r=this.onCreateCustomConvexHullImpostor(t);else{const s=new this.bjsAMMO.btConvexHullShape;0==this._addHullVerts(s,e,e)?(t._pluginData.toDispose.push(s),r=new this.bjsAMMO.btCompoundShape):r=s}break;case n.Q.NoImpostor:r=new this.bjsAMMO.btSphereShape(a.x/2);break;case n.Q.CustomImpostor:r=this._createCustom(t);break;case n.Q.SoftbodyImpostor:r=this._createSoftbody(t);break;case n.Q.ClothImpostor:r=this._createCloth(t);break;case n.Q.RopeImpostor:r=this._createRope(t);break;default:i.Y.Warn("The impostor type is not currently supported by the ammo plugin.")}return r}setTransformationFromPhysicsBody(t){t.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),t.object.position.set(this._tmpAmmoTransform.getOrigin().x(),this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z()),t.object.rotationQuaternion?t.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):t.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),this._tmpQuaternion.toEulerAnglesToRef(t.object.rotation))}setPhysicsBodyTransformation(t,s,e){const o=t.physicsBody.getWorldTransform();if(Math.abs(o.getOrigin().x()-s.x)>y.kn||Math.abs(o.getOrigin().y()-s.y)>y.kn||Math.abs(o.getOrigin().z()-s.z)>y.kn||Math.abs(o.getRotation().x()-e.x)>y.kn||Math.abs(o.getRotation().y()-e.y)>y.kn||Math.abs(o.getRotation().z()-e.z)>y.kn||Math.abs(o.getRotation().w()-e.w)>y.kn)if(this._tmpAmmoVectorA.setValue(s.x,s.y,s.z),o.setOrigin(this._tmpAmmoVectorA),this._tmpAmmoQuaternion.setValue(e.x,e.y,e.z,e.w),o.setRotation(this._tmpAmmoQuaternion),t.physicsBody.setWorldTransform(o),0==t.mass){const s=t.physicsBody.getMotionState();s&&s.setWorldTransform(o)}else t.physicsBody.activate()}isSupported(){return void 0!==this.bjsAMMO}setLinearVelocity(t,s){this._tmpAmmoVectorA.setValue(s.x,s.y,s.z),t.soft?t.physicsBody.linearVelocity(this._tmpAmmoVectorA):t.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)}setAngularVelocity(t,s){this._tmpAmmoVectorA.setValue(s.x,s.y,s.z),t.soft?t.physicsBody.angularVelocity(this._tmpAmmoVectorA):t.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)}getLinearVelocity(t){let s;if(s=t.soft?t.physicsBody.linearVelocity():t.physicsBody.getLinearVelocity(),!s)return null;const e=new o.P(s.x(),s.y(),s.z());return this.bjsAMMO.destroy(s),e}getAngularVelocity(t){let s;if(s=t.soft?t.physicsBody.angularVelocity():t.physicsBody.getAngularVelocity(),!s)return null;const e=new o.P(s.x(),s.y(),s.z());return this.bjsAMMO.destroy(s),e}setBodyMass(t,s){t.soft?t.physicsBody.setTotalMass(s,!1):t.physicsBody.setMassProps(s),t._pluginData.mass=s}getBodyMass(t){return t._pluginData.mass||0}getBodyFriction(t){return t._pluginData.friction||0}setBodyFriction(t,s){t.soft?t.physicsBody.get_m_cfg().set_kDF(s):t.physicsBody.setFriction(s),t._pluginData.friction=s}getBodyRestitution(t){return t._pluginData.restitution||0}setBodyRestitution(t,s){t.physicsBody.setRestitution(s),t._pluginData.restitution=s}getBodyPressure(t){return t.soft?t._pluginData.pressure||0:(i.Y.Warn("Pressure is not a property of a rigid body"),0)}setBodyPressure(t,s){t.soft?t.type===n.Q.SoftbodyImpostor?(t.physicsBody.get_m_cfg().set_kPR(s),t._pluginData.pressure=s):(t.physicsBody.get_m_cfg().set_kPR(0),t._pluginData.pressure=0):i.Y.Warn("Pressure can only be applied to a softbody")}getBodyStiffness(t){return t.soft?t._pluginData.stiffness||0:(i.Y.Warn("Stiffness is not a property of a rigid body"),0)}setBodyStiffness(t,s){t.soft?(s=(s=s<0?0:s)>1?1:s,t.physicsBody.get_m_materials().at(0).set_m_kLST(s),t._pluginData.stiffness=s):i.Y.Warn("Stiffness cannot be applied to a rigid body")}getBodyVelocityIterations(t){return t.soft?t._pluginData.velocityIterations||0:(i.Y.Warn("Velocity iterations is not a property of a rigid body"),0)}setBodyVelocityIterations(t,s){t.soft?(s=s<0?0:s,t.physicsBody.get_m_cfg().set_viterations(s),t._pluginData.velocityIterations=s):i.Y.Warn("Velocity iterations cannot be applied to a rigid body")}getBodyPositionIterations(t){return t.soft?t._pluginData.positionIterations||0:(i.Y.Warn("Position iterations is not a property of a rigid body"),0)}setBodyPositionIterations(t,s){t.soft?(s=s<0?0:s,t.physicsBody.get_m_cfg().set_piterations(s),t._pluginData.positionIterations=s):i.Y.Warn("Position iterations cannot be applied to a rigid body")}appendAnchor(t,s,e,o,i=1,n=!1){const r=t.segments,a=Math.round((r-1)*e)+r*(r-1-Math.round((r-1)*o));t.physicsBody.appendAnchor(a,s.physicsBody,n,i)}appendHook(t,s,e,o=1,i=!1){const n=Math.round(t.segments*e);t.physicsBody.appendAnchor(n,s.physicsBody,i,o)}sleepBody(t){t.physicsBody.forceActivationState(0)}wakeUpBody(t){t.physicsBody.activate()}updateDistanceJoint(){i.Y.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")}setMotor(t,s,e){t.physicsJoint.enableAngularMotor(!0,s,e)}setLimit(){i.Y.Warn("setLimit is not currently supported by the Ammo physics plugin")}syncMeshWithImpostor(t,s){s.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),t.position.x=this._tmpAmmoTransform.getOrigin().x(),t.position.y=this._tmpAmmoTransform.getOrigin().y(),t.position.z=this._tmpAmmoTransform.getOrigin().z(),t.rotationQuaternion&&(t.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),t.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),t.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),t.rotationQuaternion.w=this._tmpAmmoTransform.getRotation().w())}getRadius(t){return t.getObjectExtents().x/2}getBoxSizeToRef(t,s){const e=t.getObjectExtents();s.x=e.x,s.y=e.y,s.z=e.z}dispose(){this.bjsAMMO.destroy(this.world),this.bjsAMMO.destroy(this._solver),this.bjsAMMO.destroy(this._overlappingPairCache),this.bjsAMMO.destroy(this._dispatcher),this.bjsAMMO.destroy(this._collisionConfiguration),this.bjsAMMO.destroy(this._tmpAmmoVectorA),this.bjsAMMO.destroy(this._tmpAmmoVectorB),this.bjsAMMO.destroy(this._tmpAmmoVectorC),this.bjsAMMO.destroy(this._tmpAmmoTransform),this.bjsAMMO.destroy(this._tmpAmmoQuaternion),this.bjsAMMO.destroy(this._tmpAmmoConcreteContactResultCallback),this.world=null}raycast(t,s){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(t.x,t.y,t.z),this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(s.x,s.y,s.z);const e=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);return this.world.rayTest(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB,e),this._raycastResult.reset(t,s),e.hasHit()&&(this._raycastResult.setHitData({x:e.get_m_hitNormalWorld().x(),y:e.get_m_hitNormalWorld().y(),z:e.get_m_hitNormalWorld().z()},{x:e.get_m_hitPointWorld().x(),y:e.get_m_hitPointWorld().y(),z:e.get_m_hitPointWorld().z()}),this._raycastResult.calculateHitDistance()),this.bjsAMMO.destroy(e),this.bjsAMMO.destroy(this._tmpAmmoVectorRCA),this.bjsAMMO.destroy(this._tmpAmmoVectorRCB),this._raycastResult}}d._DISABLE_COLLISION_FLAG=4,d._KINEMATIC_FLAG=2,d._DISABLE_DEACTIVATION_FLAG=4},6891:(t,s,e)=>{e.d(s,{T:()=>n});var o=e(972),i=e(9938);class n{constructor(t,s=n.DefaultPluginFactory()){if(this._physicsPlugin=s,this._impostors=[],this._joints=[],this._subTimeStep=0,this._uniqueIdCounter=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");t=t||new o.P(0,-9.807,0),this.setGravity(t),this.setTimeStep()}static DefaultPluginFactory(){throw(0,i.S)("CannonJSPlugin")}setGravity(t){this.gravity=t,this._physicsPlugin.setGravity(this.gravity)}setTimeStep(t=1/60){this._physicsPlugin.setTimeStep(t)}getTimeStep(){return this._physicsPlugin.getTimeStep()}setSubTimeStep(t=0){this._subTimeStep=t}getSubTimeStep(){return this._subTimeStep}dispose(){this._impostors.forEach((function(t){t.dispose()})),this._physicsPlugin.dispose()}getPhysicsPluginName(){return this._physicsPlugin.name}addImpostor(t){this._impostors.push(t),t.uniqueId=this._uniqueIdCounter++,t.parent||this._physicsPlugin.generatePhysicsBody(t)}removeImpostor(t){const s=this._impostors.indexOf(t);s>-1&&this._impostors.splice(s,1).length&&this.getPhysicsPlugin().removePhysicsBody(t)}addJoint(t,s,e){const o={mainImpostor:t,connectedImpostor:s,joint:e};e.physicsPlugin=this._physicsPlugin,this._joints.push(o),this._physicsPlugin.generateJoint(o)}removeJoint(t,s,e){const o=this._joints.filter((function(o){return o.connectedImpostor===s&&o.joint===e&&o.mainImpostor===t}));o.length&&this._physicsPlugin.removeJoint(o[0])}_step(t){this._impostors.forEach((t=>{t.isBodyInitRequired()&&this._physicsPlugin.generatePhysicsBody(t)})),t>.1?t=.1:t<=0&&(t=1/60),this._physicsPlugin.executeStep(t,this._impostors)}getPhysicsPlugin(){return this._physicsPlugin}getImpostors(){return this._impostors}getImpostorForPhysicsObject(t){for(let s=0;s<this._impostors.length;++s)if(this._impostors[s].object===t)return this._impostors[s];return null}getImpostorWithPhysicsBody(t){for(let s=0;s<this._impostors.length;++s)if(this._impostors[s].physicsBody===t)return this._impostors[s];return null}raycast(t,s){return this._physicsPlugin.raycast(t,s)}}n.Epsilon=.001},703:(t,s,e)=>{e.d(s,{U:()=>m});var o=e(9288),i=e(4673),n=e(7257),r=e(4686),a=e(4147),h=e(6891),c=e(7504);a.x.prototype.getPhysicsEngine=function(){return this._physicsEngine},a.x.prototype.enablePhysics=function(t=null,s){if(this._physicsEngine)return!0;let e=this._getComponent(r.l.NAME_PHYSICSENGINE);e||(e=new m(this),this._addComponent(e));try{return this._physicsEngine=new h.T(t,s),this._physicsTimeAccumulator=0,!0}catch(t){return o.Y.Error(t.message),!1}},a.x.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},a.x.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},a.x.prototype.deleteCompoundImpostor=function(t){const s=t.parts[0].mesh;s.physicsImpostor&&(s.physicsImpostor.dispose(),s.physicsImpostor=null)},a.x.prototype._advancePhysicsEngineStep=function(t){if(this._physicsEngine){const s=this._physicsEngine.getSubTimeStep();if(s>0)for(this._physicsTimeAccumulator+=t;this._physicsTimeAccumulator>s;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(s/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=s;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}},Object.defineProperty(n.x.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(t){this._physicsImpostor!==t&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=t,t&&(this._disposePhysicsObserver=this.onDisposeObservable.add((()=>{this.physicsImpostor&&(this.physicsImpostor.dispose(),this.physicsImpostor=null)}))))},enumerable:!0,configurable:!0}),n.x.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},n.x.prototype.applyImpulse=function(t,s){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(t,s),this):this},n.x.prototype.setPhysicsLinkWith=function(t,s,e,o){return this.physicsImpostor&&t.physicsImpostor?(this.physicsImpostor.createJoint(t.physicsImpostor,c.q7.HingeJoint,{mainPivot:s,connectedPivot:e,nativeParams:o}),this):this};class m{constructor(t){this.name=r.l.NAME_PHYSICSENGINE,this.scene=t,this.scene.onBeforePhysicsObservable=new i.y$,this.scene.onAfterPhysicsObservable=new i.y$,this.scene.getDeterministicFrameTime=()=>this.scene._physicsEngine?1e3*this.scene._physicsEngine.getTimeStep():1e3/60}register(){}rebuild(){}dispose(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()}}},5388:(t,s,e)=>{e.d(s,{d:()=>i});var o=e(972);class i{constructor(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=o.P.Zero(),this._hitPointWorld=o.P.Zero(),this._rayFromWorld=o.P.Zero(),this._rayToWorld=o.P.Zero()}get hasHit(){return this._hasHit}get hitDistance(){return this._hitDistance}get hitNormalWorld(){return this._hitNormalWorld}get hitPointWorld(){return this._hitPointWorld}get rayFromWorld(){return this._rayFromWorld}get rayToWorld(){return this._rayToWorld}setHitData(t,s){this._hasHit=!0,this._hitNormalWorld=new o.P(t.x,t.y,t.z),this._hitPointWorld=new o.P(s.x,s.y,s.z)}setHitDistance(t){this._hitDistance=t}calculateHitDistance(){this._hitDistance=o.P.Distance(this._rayFromWorld,this._hitPointWorld)}reset(t=o.P.Zero(),s=o.P.Zero()){this._rayFromWorld=t,this._rayToWorld=s,this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=o.P.Zero(),this._hitPointWorld=o.P.Zero()}}}}]);
//# sourceMappingURL=907.babylonBundle.js.map