{"version":3,"file":"js/403.babylonBundle.js","mappings":"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","sources":["webpack://pro-racer/./src/scenes/controls.ts"],"sourcesContent":["import { Axis } from \"@babylonjs/core/Maths/math\";\nimport { Car } from \"./car\";\n\nconst actions = new Map<string, boolean>([\n    [\"acceleration\", false],\n    [\"braking\", false],\n    [\"right\", false],\n    [\"left\", false],\n    [\"reset\", false]\n]);\n\nconst keysActions = new Map<string, string>([\n    [\"KeyW\",'acceleration'],\n    [\"KeyS\",'braking'],\n    [\"KeyA\",'left'],\n    [\"KeyD\",'right'],\n    [\"KeyR\", 'reset']\n]);\n\nexport class Controls {\n\n    car: Car;\n\n    constructor(car: Car) {\n        this.car = car;\n        window.addEventListener( 'keydown', this.keydown);\n        window.addEventListener( 'keyup', this.keyup);\n    }\n\n    update() {\n        if(this.car.vehicleReady){\n                  \n            const speed = this.car.vehicle.getCurrentSpeedKmHour();\n            const maxSteerVal = 0.2;\n            this.car.breakingForce = 0;\n            this.car.engineForce = 0;\n\n            if (actions.get(\"reset\")) {\n                this.car.chassisMesh.position.set(0, 5, 0);\n                console.log(\"reset\");\n            }\n\n            \n            if(actions.get(\"acceleration\")){\n                if (speed < -1){\n                    this.car.breakingForce = this.car.maxBreakingForce;\n                }else {\n                    this.car.engineForce = this.car.maxEngineForce;\n                }\n                    \n            } else if(actions.get(\"braking\")){\n                if (speed > 1){\n                    this.car.breakingForce = this.car.maxBreakingForce;\n                }else {\n                    this.car.engineForce = -this.car.maxEngineForce ;\n                }\n            } \n                    \n            if(actions.get(\"right\")){\n                if (this.car.vehicleSteering < this.car.steeringClamp){\n                    this.car.vehicleSteering += this.car.steeringIncrement;\n                }\n                    \n            } else if(actions.get(\"left\")){\n                if (this.car.vehicleSteering > -this.car.steeringClamp){\n                    this.car.vehicleSteering -= this.car.steeringIncrement;\n                }\n                    \n            } else {\n                this.car.vehicleSteering = 0;\n            }\n                    \n            this.car.vehicle.applyEngineForce(this.car.engineForce, this.car.FRONT_LEFT);\n            this.car.vehicle.applyEngineForce(this.car.engineForce, this.car.FRONT_RIGHT);\n                    \n            this.car.vehicle.setBrake(this.car.breakingForce / 2, this.car.FRONT_LEFT);\n            this.car.vehicle.setBrake(this.car.breakingForce / 2, this.car.FRONT_RIGHT);\n            this.car.vehicle.setBrake(this.car.breakingForce, this.car.BACK_LEFT);\n            this.car.vehicle.setBrake(this.car.breakingForce, this.car.BACK_RIGHT);\n                    \n            this.car.vehicle.setSteeringValue(this.car.vehicleSteering, this.car.FRONT_LEFT);\n            this.car.vehicle.setSteeringValue(this.car.vehicleSteering, this.car.FRONT_RIGHT);\n                    \n                    \n            let tm, p, q, i;\n            const n = this.car.vehicle.getNumWheels();\n            for (i = 0; i < n; i++) {\n                this.car.vehicle.updateWheelTransform(i, true);\n                tm = this.car.vehicle.getWheelTransformWS(i);\n                p = tm.getOrigin();\n                q = tm.getRotation();\n                this.car.wheelMeshes[i].position.set(p.x(), p.y(), p.z());\n                this.car.wheelMeshes[i].rotationQuaternion?.set(q.x(), q.y(), q.z(), q.w());\n                this.car.wheelMeshes[i].rotate(Axis.Z, Math.PI/2);\n            }\n\n            tm = this.car.vehicle.getChassisWorldTransform();\n            p = tm.getOrigin();\n            q = tm.getRotation();\n            this.car.chassisMesh.position.set(p.x(), p.y(), p.z());\n            this.car.chassisMesh.rotationQuaternion?.set(q.x(), q.y(), q.z(), q.w());\n            this.car.chassisMesh.rotate(Axis.X, Math.PI);\n                 \n        }\n    }\n\n    private keyup(e: KeyboardEvent) {\n        if(keysActions.get(e.code)) {\n            actions.set(keysActions.get(e.code)??\"\", false);\n            //e.preventDefault();\n            //e.stopPropagation();\n\n            //return false;\n        }\n    }\n\n    private keydown(e: KeyboardEvent) {\n        if(keysActions.get(e.code)) {\n            actions.set(keysActions.get(e.code)??\"\", true);\n            //e.preventDefault();\n            //e.stopPropagation();\n\n            //return false;\n        }\n    }\n\n\n}\n"],"names":["actions","Map","keysActions","Controls","constructor","car","this","window","addEventListener","keydown","keyup","update","vehicleReady","speed","vehicle","getCurrentSpeedKmHour","tm","p","q","i","breakingForce","engineForce","get","chassisMesh","position","set","console","log","maxBreakingForce","maxEngineForce","vehicleSteering","steeringClamp","steeringIncrement","applyEngineForce","FRONT_LEFT","FRONT_RIGHT","setBrake","BACK_LEFT","BACK_RIGHT","setSteeringValue","n","getNumWheels","updateWheelTransform","getWheelTransformWS","getOrigin","getRotation","wheelMeshes","x","y","z","rotationQuaternion","w","rotate","Math","PI","getChassisWorldTransform","e","code"],"sourceRoot":""}