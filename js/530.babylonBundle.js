"use strict";(self.webpackChunkbabylonjs_typescript_webpack_simple_scene=self.webpackChunkbabylonjs_typescript_webpack_simple_scene||[]).push([[530],{3427:(t,e,i)=>{i.d(e,{f:()=>_,u:()=>p});var s=i(972),a=i(9859),n=i(1865),o=i(6786),r=i(9827),h=i(4629),c=i(9556),l=i(2528),u=i(7743),d=i(2059);class p{}class _{constructor(t,e,i,s,a,n){this.name=t,this.targetProperty=e,this.framePerSecond=i,this.dataType=s,this.loopMode=a,this.enableBlending=n,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=e.split("."),this.dataType=s,this.loopMode=void 0===a?_.ANIMATIONLOOPMODE_CYCLE:a,this.uniqueId=_._UniqueIdGenerator++}static _PrepareAnimation(t,e,i,n,o,r,h,c){let l;if(!isNaN(parseFloat(o))&&isFinite(o)?l=_.ANIMATIONTYPE_FLOAT:o instanceof s._f?l=_.ANIMATIONTYPE_QUATERNION:o instanceof s.P?l=_.ANIMATIONTYPE_VECTOR3:o instanceof s.FM?l=_.ANIMATIONTYPE_VECTOR2:o instanceof a.Wo?l=_.ANIMATIONTYPE_COLOR3:o instanceof a.HE?l=_.ANIMATIONTYPE_COLOR4:o instanceof u.$&&(l=_.ANIMATIONTYPE_SIZE),null==l)return null;const d=new _(t,e,i,l,h),p=[{frame:0,value:o},{frame:n,value:r}];return d.setKeys(p),void 0!==c&&d.setEasingFunction(c),d}static CreateAnimation(t,e,i,s){const a=new _(t+"Animation",t,i,e,_.ANIMATIONLOOPMODE_CONSTANT);return a.setEasingFunction(s),a}static CreateAndStartAnimation(t,e,i,s,a,n,o,r,h,c,l){const u=_._PrepareAnimation(t,i,s,a,n,o,r,h);return u?(e.getScene&&(l=e.getScene()),l?l.beginDirectAnimation(e,[u],0,a,1===u.loopMode,1,c):null):null}static CreateAndStartHierarchyAnimation(t,e,i,s,a,n,o,r,h,c,l){const u=_._PrepareAnimation(t,s,a,n,o,r,h,c);return u?e.getScene().beginDirectHierarchyAnimation(e,i,[u],0,n,1===u.loopMode,1,l):null}static CreateMergeAndStartAnimation(t,e,i,s,a,n,o,r,h,c){const l=_._PrepareAnimation(t,i,s,a,n,o,r,h);return l?(e.animations.push(l),e.getScene().beginAnimation(e,0,a,1===l.loopMode,1,c)):null}static MakeAnimationAdditive(t,e=0,i,a=!1,n){let o=t;if(a&&(o=t.clone(),o.name=n||o.name),!o._keys.length)return o;e=e>=0?e:0;let r=0;const h=o._keys[0];let c=o._keys.length-1;const l=o._keys[c],u={referenceValue:h.value,referencePosition:s.jp.Vector3[0],referenceQuaternion:s.jp.Quaternion[0],referenceScaling:s.jp.Vector3[1],keyPosition:s.jp.Vector3[2],keyQuaternion:s.jp.Quaternion[1],keyScaling:s.jp.Vector3[3]};let d=!1,p=h.frame,m=l.frame;if(i){const t=o.getRange(i);t&&(p=t.from,m=t.to)}let g=h.frame===p,T=l.frame===m;if(1===o._keys.length){const t=o._getKeyValue(o._keys[0]);u.referenceValue=t.clone?t.clone():t,d=!0}else if(e<=h.frame){const t=o._getKeyValue(h.value);u.referenceValue=t.clone?t.clone():t,d=!0}else if(e>=l.frame){const t=o._getKeyValue(l.value);u.referenceValue=t.clone?t.clone():t,d=!0}let f=0;for(;!d||!g||!T&&f<o._keys.length-1;){const t=o._keys[f],i=o._keys[f+1];if(!d&&e>=t.frame&&e<=i.frame){let s;if(e===t.frame)s=o._getKeyValue(t.value);else if(e===i.frame)s=o._getKeyValue(i.value);else{const t={key:f,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};s=o._interpolate(e,t)}u.referenceValue=s.clone?s.clone():s,d=!0}if(!g&&p>=t.frame&&p<=i.frame){if(p===t.frame)r=f;else if(p===i.frame)r=f+1;else{const t={key:f,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},e=o._interpolate(p,t),i={frame:p,value:e.clone?e.clone():e};o._keys.splice(f+1,0,i),r=f+1}g=!0}if(!T&&m>=t.frame&&m<=i.frame){if(m===t.frame)c=f;else if(m===i.frame)c=f+1;else{const t={key:f,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},e=o._interpolate(m,t),i={frame:m,value:e.clone?e.clone():e};o._keys.splice(f+1,0,i),c=f+1}T=!0}f++}for(o.dataType===_.ANIMATIONTYPE_QUATERNION?u.referenceValue.normalize().conjugateInPlace():o.dataType===_.ANIMATIONTYPE_MATRIX&&(u.referenceValue.decompose(u.referenceScaling,u.referenceQuaternion,u.referencePosition),u.referenceQuaternion.normalize().conjugateInPlace()),f=r;f<=c;f++){const t=o._keys[f];if(!f||o.dataType===_.ANIMATIONTYPE_FLOAT||t.value!==h.value)switch(o.dataType){case _.ANIMATIONTYPE_MATRIX:t.value.decompose(u.keyScaling,u.keyQuaternion,u.keyPosition),u.keyPosition.subtractInPlace(u.referencePosition),u.keyScaling.divideInPlace(u.referenceScaling),u.referenceQuaternion.multiplyToRef(u.keyQuaternion,u.keyQuaternion),s.y3.ComposeToRef(u.keyScaling,u.keyQuaternion,u.keyPosition,t.value);break;case _.ANIMATIONTYPE_QUATERNION:u.referenceValue.multiplyToRef(t.value,t.value);break;case _.ANIMATIONTYPE_VECTOR2:case _.ANIMATIONTYPE_VECTOR3:case _.ANIMATIONTYPE_COLOR3:case _.ANIMATIONTYPE_COLOR4:t.value.subtractToRef(u.referenceValue,t.value);break;case _.ANIMATIONTYPE_SIZE:t.value.width-=u.referenceValue.width,t.value.height-=u.referenceValue.height;break;default:t.value-=u.referenceValue}}return o}static TransitionTo(t,e,i,s,a,n,o,r=null){if(o<=0)return i[t]=e,r&&r(),null;const h=a*(o/1e3);n.setKeys([{frame:0,value:i[t].clone?i[t].clone():i[t]},{frame:h,value:e}]),i.animations||(i.animations=[]),i.animations.push(n);const c=s.beginAnimation(i,0,h,!1);return c.onAnimationEnd=r,c}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const t of this._runtimeAnimations)if(!t.isStopped())return!0;return!1}toString(t){let e="Name: "+this.name+", property: "+this.targetProperty;if(e+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],e+=", nKeys: "+(this._keys?this._keys.length:"none"),e+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){e+=", Ranges: {";let t=!0;for(const i in this._ranges)t&&(e+=", ",t=!1),e+=i;e+="}"}return e}addEvent(t){this._events.push(t),this._events.sort(((t,e)=>t.frame-e.frame))}removeEvents(t){for(let e=0;e<this._events.length;e++)this._events[e].frame===t&&(this._events.splice(e,1),e--)}getEvents(){return this._events}createRange(t,e,i){this._ranges[t]||(this._ranges[t]=new c.X(t,e,i))}deleteRange(t,e=!0){const i=this._ranges[t];if(i){if(e){const t=i.from,e=i.to;for(let i=this._keys.length-1;i>=0;i--)this._keys[i].frame>=t&&this._keys[i].frame<=e&&this._keys.splice(i,1)}this._ranges[t]=null}}getRange(t){return this._ranges[t]}getKeys(){return this._keys}getHighestFrame(){let t=0;for(let e=0,i=this._keys.length;e<i;e++)t<this._keys[e].frame&&(t=this._keys[e].frame);return t}getEasingFunction(){return this._easingFunction}setEasingFunction(t){this._easingFunction=t}floatInterpolateFunction(t,e,i){return n.R.Lerp(t,e,i)}floatInterpolateFunctionWithTangents(t,e,i,s,a){return n.R.Hermite(t,e,i,s,a)}quaternionInterpolateFunction(t,e,i){return s._f.Slerp(t,e,i)}quaternionInterpolateFunctionWithTangents(t,e,i,a,n){return s._f.Hermite(t,e,i,a,n).normalize()}vector3InterpolateFunction(t,e,i){return s.P.Lerp(t,e,i)}vector3InterpolateFunctionWithTangents(t,e,i,a,n){return s.P.Hermite(t,e,i,a,n)}vector2InterpolateFunction(t,e,i){return s.FM.Lerp(t,e,i)}vector2InterpolateFunctionWithTangents(t,e,i,a,n){return s.FM.Hermite(t,e,i,a,n)}sizeInterpolateFunction(t,e,i){return u.$.Lerp(t,e,i)}color3InterpolateFunction(t,e,i){return a.Wo.Lerp(t,e,i)}color3InterpolateFunctionWithTangents(t,e,i,s,n){return a.Wo.Hermite(t,e,i,s,n)}color4InterpolateFunction(t,e,i){return a.HE.Lerp(t,e,i)}color4InterpolateFunctionWithTangents(t,e,i,s,n){return a.HE.Hermite(t,e,i,s,n)}_getKeyValue(t){return"function"==typeof t?t():t}evaluate(t){return this._interpolate(t,{key:0,repeatCount:0,loopMode:_.ANIMATIONLOOPMODE_CONSTANT})}_interpolate(t,e){if(e.loopMode===_.ANIMATIONLOOPMODE_CONSTANT&&e.repeatCount>0)return e.highLimitValue.clone?e.highLimitValue.clone():e.highLimitValue;const i=this._keys,s=i.length;let a=e.key;for(;a>=0&&t<i[a].frame;)--a;for(;a+1<=s-1&&t>=i[a+1].frame;)++a;if(e.key=a,a<0)return this._getKeyValue(i[0].value);if(a+1>s-1)return this._getKeyValue(i[s-1].value);const n=i[a],o=i[a+1],r=this._getKeyValue(n.value),c=this._getKeyValue(o.value);if(n.interpolation===h.N.STEP)return o.frame>t?r:c;const l=void 0!==n.outTangent&&void 0!==o.inTangent,u=o.frame-n.frame;let d=(t-n.frame)/u;const p=this.getEasingFunction();switch(null!==p&&(d=p.ease(d)),this.dataType){case _.ANIMATIONTYPE_FLOAT:{const t=l?this.floatInterpolateFunctionWithTangents(r,n.outTangent*u,c,o.inTangent*u,d):this.floatInterpolateFunction(r,c,d);switch(e.loopMode){case _.ANIMATIONLOOPMODE_CYCLE:case _.ANIMATIONLOOPMODE_CONSTANT:return t;case _.ANIMATIONLOOPMODE_RELATIVE:return e.offsetValue*e.repeatCount+t}break}case _.ANIMATIONTYPE_QUATERNION:{const t=l?this.quaternionInterpolateFunctionWithTangents(r,n.outTangent.scale(u),c,o.inTangent.scale(u),d):this.quaternionInterpolateFunction(r,c,d);switch(e.loopMode){case _.ANIMATIONLOOPMODE_CYCLE:case _.ANIMATIONLOOPMODE_CONSTANT:return t;case _.ANIMATIONLOOPMODE_RELATIVE:return t.addInPlace(e.offsetValue.scale(e.repeatCount))}return t}case _.ANIMATIONTYPE_VECTOR3:{const t=l?this.vector3InterpolateFunctionWithTangents(r,n.outTangent.scale(u),c,o.inTangent.scale(u),d):this.vector3InterpolateFunction(r,c,d);switch(e.loopMode){case _.ANIMATIONLOOPMODE_CYCLE:case _.ANIMATIONLOOPMODE_CONSTANT:return t;case _.ANIMATIONLOOPMODE_RELATIVE:return t.add(e.offsetValue.scale(e.repeatCount))}break}case _.ANIMATIONTYPE_VECTOR2:{const t=l?this.vector2InterpolateFunctionWithTangents(r,n.outTangent.scale(u),c,o.inTangent.scale(u),d):this.vector2InterpolateFunction(r,c,d);switch(e.loopMode){case _.ANIMATIONLOOPMODE_CYCLE:case _.ANIMATIONLOOPMODE_CONSTANT:return t;case _.ANIMATIONLOOPMODE_RELATIVE:return t.add(e.offsetValue.scale(e.repeatCount))}break}case _.ANIMATIONTYPE_SIZE:switch(e.loopMode){case _.ANIMATIONLOOPMODE_CYCLE:case _.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(r,c,d);case _.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(r,c,d).add(e.offsetValue.scale(e.repeatCount))}break;case _.ANIMATIONTYPE_COLOR3:{const t=l?this.color3InterpolateFunctionWithTangents(r,n.outTangent.scale(u),c,o.inTangent.scale(u),d):this.color3InterpolateFunction(r,c,d);switch(e.loopMode){case _.ANIMATIONLOOPMODE_CYCLE:case _.ANIMATIONLOOPMODE_CONSTANT:return t;case _.ANIMATIONLOOPMODE_RELATIVE:return t.add(e.offsetValue.scale(e.repeatCount))}break}case _.ANIMATIONTYPE_COLOR4:{const t=l?this.color4InterpolateFunctionWithTangents(r,n.outTangent.scale(u),c,o.inTangent.scale(u),d):this.color4InterpolateFunction(r,c,d);switch(e.loopMode){case _.ANIMATIONLOOPMODE_CYCLE:case _.ANIMATIONLOOPMODE_CONSTANT:return t;case _.ANIMATIONLOOPMODE_RELATIVE:return t.add(e.offsetValue.scale(e.repeatCount))}break}case _.ANIMATIONTYPE_MATRIX:switch(e.loopMode){case _.ANIMATIONLOOPMODE_CYCLE:case _.ANIMATIONLOOPMODE_CONSTANT:return _.AllowMatricesInterpolation?this.matrixInterpolateFunction(r,c,d,e.workValue):r;case _.ANIMATIONLOOPMODE_RELATIVE:return r}}return 0}matrixInterpolateFunction(t,e,i,a){return _.AllowMatrixDecomposeForInterpolation?a?(s.y3.DecomposeLerpToRef(t,e,i,a),a):s.y3.DecomposeLerp(t,e,i):a?(s.y3.LerpToRef(t,e,i,a),a):s.y3.Lerp(t,e,i)}clone(){const t=new _(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges){t._ranges={};for(const e in this._ranges){const i=this._ranges[e];i&&(t._ranges[e]=i.clone())}}return t}setKeys(t){this._keys=t.slice(0)}serialize(){const t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;const e=this.dataType;t.keys=[];const i=this.getKeys();for(let s=0;s<i.length;s++){const a=i[s],n={};switch(n.frame=a.frame,e){case _.ANIMATIONTYPE_FLOAT:n.values=[a.value],void 0!==a.inTangent&&n.values.push(a.inTangent),void 0!==a.outTangent&&(void 0===a.inTangent&&n.values.push(void 0),n.values.push(a.outTangent)),void 0!==a.interpolation&&(void 0===a.inTangent&&n.values.push(void 0),void 0===a.outTangent&&n.values.push(void 0),n.values.push(a.interpolation));break;case _.ANIMATIONTYPE_QUATERNION:case _.ANIMATIONTYPE_MATRIX:case _.ANIMATIONTYPE_VECTOR3:case _.ANIMATIONTYPE_COLOR3:case _.ANIMATIONTYPE_COLOR4:n.values=a.value.asArray(),null!=a.inTangent&&n.values.push(a.inTangent.asArray()),null!=a.outTangent&&(void 0===a.inTangent&&n.values.push(void 0),n.values.push(a.outTangent.asArray())),void 0!==a.interpolation&&(void 0===a.inTangent&&n.values.push(void 0),void 0===a.outTangent&&n.values.push(void 0),n.values.push(a.interpolation))}t.keys.push(n)}t.ranges=[];for(const e in this._ranges){const i=this._ranges[e];if(!i)continue;const s={};s.name=e,s.from=i.from,s.to=i.to,t.ranges.push(s)}return t}static _UniversalLerp(t,e,i){const s=t.constructor;return s.Lerp?s.Lerp(t,e,i):s.Slerp?s.Slerp(t,e,i):t.toFixed?t*(1-i)+i*e:e}static Parse(t){const e=new _(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),i=t.dataType,n=[];let o,r;for(t.enableBlending&&(e.enableBlending=t.enableBlending),t.blendingSpeed&&(e.blendingSpeed=t.blendingSpeed),r=0;r<t.keys.length;r++){const e=t.keys[r];let h,c,l;switch(i){case _.ANIMATIONTYPE_FLOAT:o=e.values[0],e.values.length>=2&&(h=e.values[1]),e.values.length>=3&&(c=e.values[2]),e.values.length>=4&&(l=e.values[3]);break;case _.ANIMATIONTYPE_QUATERNION:if(o=s._f.FromArray(e.values),e.values.length>=8){const t=s._f.FromArray(e.values.slice(4,8));t.equals(s._f.Zero())||(h=t)}if(e.values.length>=12){const t=s._f.FromArray(e.values.slice(8,12));t.equals(s._f.Zero())||(c=t)}e.values.length>=13&&(l=e.values[12]);break;case _.ANIMATIONTYPE_MATRIX:o=s.y3.FromArray(e.values),e.values.length>=17&&(l=e.values[16]);break;case _.ANIMATIONTYPE_COLOR3:o=a.Wo.FromArray(e.values),e.values[3]&&(h=a.Wo.FromArray(e.values[3])),e.values[4]&&(c=a.Wo.FromArray(e.values[4])),e.values[5]&&(l=e.values[5]);break;case _.ANIMATIONTYPE_COLOR4:o=a.HE.FromArray(e.values),e.values[4]&&(h=a.HE.FromArray(e.values[4])),e.values[5]&&(c=a.HE.FromArray(e.values[5])),e.values[6]&&(l=a.HE.FromArray(e.values[6]));break;case _.ANIMATIONTYPE_VECTOR3:default:o=s.P.FromArray(e.values),e.values[3]&&(h=s.P.FromArray(e.values[3])),e.values[4]&&(c=s.P.FromArray(e.values[4])),e.values[5]&&(l=e.values[5])}const u={};u.frame=e.frame,u.value=o,null!=h&&(u.inTangent=h),null!=c&&(u.outTangent=c),null!=l&&(u.interpolation=l),n.push(u)}if(e.setKeys(n),t.ranges)for(r=0;r<t.ranges.length;r++)o=t.ranges[r],e.createRange(o.name,o.from,o.to);return e}static AppendSerializedAnimations(t,e){o.p4.AppendSerializedAnimations(t,e)}static ParseFromFileAsync(t,e){return new Promise(((i,s)=>{const a=new d.g;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){let e=JSON.parse(a.responseText);if(e.animations&&(e=e.animations),e.length){const t=new Array;for(const i of e)t.push(this.Parse(i));i(t)}else{const s=this.Parse(e);t&&(s.name=t),i(s)}}else s("Unable to load the animation")})),a.open("GET",e),a.send()}))}static ParseFromSnippetAsync(t){return new Promise(((e,i)=>{const s=new d.g;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const i=JSON.parse(JSON.parse(s.responseText).jsonPayload);if(i.animations){const s=JSON.parse(i.animations),a=new Array;for(const e of s.animations){const i=this.Parse(e);i.snippetId=t,a.push(i)}e(a)}else{const s=JSON.parse(i.animation),a=this.Parse(s);a.snippetId=t,e(a)}}else i("Unable to load the snippet "+t)})),s.open("GET",this.SnippetUrl+"/"+t.replace(/#/g,"/")),s.send()}))}}_._UniqueIdGenerator=0,_.AllowMatricesInterpolation=!1,_.AllowMatrixDecomposeForInterpolation=!0,_.SnippetUrl="https://snippet.babylonjs.com",_.ANIMATIONTYPE_FLOAT=0,_.ANIMATIONTYPE_VECTOR3=1,_.ANIMATIONTYPE_QUATERNION=2,_.ANIMATIONTYPE_MATRIX=3,_.ANIMATIONTYPE_COLOR3=4,_.ANIMATIONTYPE_COLOR4=7,_.ANIMATIONTYPE_VECTOR2=5,_.ANIMATIONTYPE_SIZE=6,_.ANIMATIONLOOPMODE_RELATIVE=0,_.ANIMATIONLOOPMODE_CYCLE=1,_.ANIMATIONLOOPMODE_CONSTANT=2,_.CreateFromSnippetAsync=_.ParseFromSnippetAsync,(0,r.H)("BABYLON.Animation",_),l.N._AnimationRangeFactory=(t,e,i)=>new c.X(t,e,i)},4629:(t,e,i)=>{var s;i.d(e,{N:()=>s}),function(t){t[t.NONE=0]="NONE",t[t.STEP=1]="STEP"}(s||(s={}))},9556:(t,e,i)=>{i.d(e,{X:()=>s});class s{constructor(t,e,i){this.name=t,this.from=e,this.to=i}clone(){return new s(this.name,this.from,this.to)}}},9011:(t,e,i)=>{i.d(e,{$A:()=>c,EI:()=>l,Kp:()=>a,Pu:()=>u,R$:()=>r,TO:()=>p,bi:()=>m,m2:()=>_,o0:()=>h,qP:()=>n,sj:()=>g,ud:()=>o,v:()=>d});var s=i(1021);class a{constructor(){this._easingMode=a.EASINGMODE_EASEIN}setEasingMode(t){const e=Math.min(Math.max(t,0),2);this._easingMode=e}getEasingMode(){return this._easingMode}easeInCore(t){throw new Error("You must implement this method")}ease(t){switch(this._easingMode){case a.EASINGMODE_EASEIN:return this.easeInCore(t);case a.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)}}a.EASINGMODE_EASEIN=0,a.EASINGMODE_EASEOUT=1,a.EASINGMODE_EASEINOUT=2;class n extends a{easeInCore(t){return t=Math.max(0,Math.min(1,t)),1-Math.sqrt(1-t*t)}}class o extends a{constructor(t=1){super(),this.amplitude=t}easeInCore(t){const e=Math.max(0,this.amplitude);return Math.pow(t,3)-t*e*Math.sin(3.141592653589793*t)}}class r extends a{constructor(t=3,e=2){super(),this.bounces=t,this.bounciness=e}easeInCore(t){const e=Math.max(0,this.bounces);let i=this.bounciness;i<=1&&(i=1.001);const s=Math.pow(i,e),a=1-i,n=(1-s)/a+.5*s,o=t*n,r=Math.log(-o*(1-i)+1)/Math.log(i),h=Math.floor(r),c=h+1,l=(1-Math.pow(i,h))/(a*n),u=.5*(l+(1-Math.pow(i,c))/(a*n)),d=t-u,p=u-l;return-Math.pow(1/i,e-h)/(p*p)*(d-p)*(d+p)}}class h extends a{easeInCore(t){return t*t*t}}class c extends a{constructor(t=3,e=3){super(),this.oscillations=t,this.springiness=e}easeInCore(t){let e;const i=Math.max(0,this.oscillations),s=Math.max(0,this.springiness);return e=0==s?t:(Math.exp(s*t)-1)/(Math.exp(s)-1),e*Math.sin((6.283185307179586*i+1.5707963267948966)*t)}}class l extends a{constructor(t=2){super(),this.exponent=t}easeInCore(t){return this.exponent<=0?t:(Math.exp(this.exponent*t)-1)/(Math.exp(this.exponent)-1)}}class u extends a{constructor(t=2){super(),this.power=t}easeInCore(t){const e=Math.max(0,this.power);return Math.pow(t,e)}}class d extends a{easeInCore(t){return t*t}}class p extends a{easeInCore(t){return t*t*t*t}}class _ extends a{easeInCore(t){return t*t*t*t*t}}class m extends a{easeInCore(t){return 1-Math.sin(1.5707963267948966*(1-t))}}class g extends a{constructor(t=0,e=0,i=1,s=1){super(),this.x1=t,this.y1=e,this.x2=i,this.y2=s}easeInCore(t){return s.hr.Interpolate(t,this.x1,this.y1,this.x2,this.y2)}}},1480:(t,e,i)=>{i.d(e,{o:()=>o});var s=i(147),a=i(6461),n=i(7786);class o{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(t){this._zoomStopsAnimation=t}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(t){this._idleRotationSpeed=t}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(t){this._idleRotationWaitTime=t}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(t){this._idleRotationSpinupTime=t}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(t){this._attachedCamera=t;const e=this._attachedCamera.getScene();this._onPrePointerObservableObserver=e.onPrePointerObservable.add((t=>{t.type!==s.kD.POINTERDOWN?t.type===s.kD.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const t=a.F.Now;let e=0;null!=this._lastFrameTime&&(e=t-this._lastFrameTime),this._lastFrameTime=t,this._applyUserInteraction();const i=t-this._lastInteractionTime-this._idleRotationWaitTime,s=Math.max(Math.min(i/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*s,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(e/1e3))}))}detach(){if(!this._attachedCamera)return;const t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}resetLastInteractionTime(t){this._lastInteractionTime=null!=t?t:a.F.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<n.kn}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let t=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(t=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?t:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=a.F.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}},3425:(t,e,i)=>{i.d(e,{r:()=>n});var s=i(9011),a=i(3427);class n{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(t){if(this._autoTransitionRange===t)return;this._autoTransitionRange=t;const e=this._attachedCamera;e&&(t?this._onMeshTargetChangedObserver=e.onMeshTargetChangedObservable.add((t=>{if(!t)return;t.computeWorldMatrix(!0);const e=t.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*e,this.upperRadiusTransitionRange=.05*e})):this._onMeshTargetChangedObserver&&e.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(t){this._attachedCamera=t,this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(t){return!!this._attachedCamera&&this._attachedCamera.radius===t&&!this._radiusIsAnimating}_applyBoundRadiusAnimation(t){if(!this._attachedCamera)return;this._radiusBounceTransition||(n.EasingFunction.setEasingMode(n.EasingMode),this._radiusBounceTransition=a.f.CreateAnimation("radius",a.f.ANIMATIONTYPE_FLOAT,60,n.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const e=a.f.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));e&&this._animatables.push(e)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}n.EasingFunction=new s.ud(.3),n.EasingMode=s.Kp.EASINGMODE_EASEOUT},1193:(t,e,i)=>{i.d(e,{d:()=>c});var s=i(9011),a=i(4673),n=i(147),o=i(6461),r=i(972),h=i(3427);class c{constructor(){this.onTargetFramingAnimationEndObservable=new a.y$,this._mode=c.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(t){this._mode=t}get mode(){return this._mode}set radiusScale(t){this._radiusScale=t}get radiusScale(){return this._radiusScale}set positionScale(t){this._positionScale=t}get positionScale(){return this._positionScale}set defaultElevation(t){this._defaultElevation=t}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(t){this._elevationReturnTime=t}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(t){this._elevationReturnWaitTime=t}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(t){this._zoomStopsAnimation=t}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(t){this._framingTime=t}get framingTime(){return this._framingTime}init(){}attach(t){this._attachedCamera=t;const e=this._attachedCamera.getScene();c.EasingFunction.setEasingMode(c.EasingMode),this._onPrePointerObservableObserver=e.onPrePointerObservable.add((t=>{t.type!==n.kD.POINTERDOWN?t.type===n.kD.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((t=>{t&&this.zoomOnMesh(t,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(t,e=!1,i=null){t.computeWorldMatrix(!0);const s=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(s.minimumWorld,s.maximumWorld,e,i)}zoomOnMeshHierarchy(t,e=!1,i=null){t.computeWorldMatrix(!0);const s=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(s.min,s.max,e,i)}zoomOnMeshesHierarchy(t,e=!1,i=null){const s=new r.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let e=0;e<t.length;e++){const i=t[e].getHierarchyBoundingVectors(!0);r.P.CheckExtends(i.min,s,a),r.P.CheckExtends(i.max,s,a)}this.zoomOnBoundingInfo(s,a,e,i)}zoomOnBoundingInfo(t,e,i=!1,s=null){let a;if(!this._attachedCamera)return;const n=t.y,o=n+(e.y-n)*this._positionScale,l=e.subtract(t).scale(.5);if(i)a=new r.P(0,o,0);else{const e=t.add(l);a=new r.P(e.x,o,e.z)}this._vectorTransition||(this._vectorTransition=h.f.CreateAnimation("target",h.f.ANIMATIONTYPE_VECTOR3,60,c.EasingFunction)),this._betaIsAnimating=!0;let u=h.f.TransitionTo("target",a,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);u&&this._animatables.push(u);let d=0;if(this._mode===c.FitFrustumSidesMode){const i=this._calculateLowerRadiusFromModelBoundingSphere(t,e);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=l.length()+this._attachedCamera.minZ),d=i}else this._mode===c.IgnoreBoundsSizeMode&&(d=this._calculateLowerRadiusFromModelBoundingSphere(t,e),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){const i=e.subtract(t).length();this._attachedCamera.panningSensibility=5e3/i,this._attachedCamera.wheelPrecision=100/d}this._radiusTransition||(this._radiusTransition=h.f.CreateAnimation("radius",h.f.ANIMATIONTYPE_FLOAT,60,c.EasingFunction)),u=h.f.TransitionTo("radius",d,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),s&&s(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),u&&this._animatables.push(u)}_calculateLowerRadiusFromModelBoundingSphere(t,e){const i=e.subtract(t).length(),s=this._getFrustumSlope(),a=.5*i*this._radiusScale,n=a*Math.sqrt(1+1/(s.x*s.x)),o=a*Math.sqrt(1+1/(s.y*s.y));let r=Math.max(n,o);const h=this._attachedCamera;return h?(h.lowerRadiusLimit&&this._mode===c.IgnoreBoundsSizeMode&&(r=r<h.lowerRadiusLimit?h.lowerRadiusLimit:r),h.upperRadiusLimit&&(r=r>h.upperRadiusLimit?h.upperRadiusLimit:r),r):0}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const t=o.F.Now-this._lastInteractionTime,e=.5*Math.PI-this._defaultElevation,i=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>i&&t>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=h.f.CreateAnimation("beta",h.f.ANIMATIONTYPE_FLOAT,60,c.EasingFunction));const t=h.f.TransitionTo("beta",e,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));t&&this._animatables.push(t)}}_getFrustumSlope(){const t=this._attachedCamera;if(!t)return r.FM.Zero();const e=t.getScene().getEngine().getAspectRatio(t),i=Math.tan(t.fov/2),s=i*e;return new r.FM(s,i)}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=o.F.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}c.EasingFunction=new s.EI,c.EasingMode=s.Kp.EASINGMODE_EASEINOUT,c.IgnoreBoundsSizeMode=0,c.FitFrustumSidesMode=1},7632:(t,e,i)=>{i.d(e,{O:()=>r});var s=i(3555),a=i(6786),n=i(4651),o=i(147);class r{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(t){t=n.w1.BackCompatCameraNoPreventDefault(arguments);const e=this.camera.getEngine(),i=e.getInputElement();let s=0,a=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=n=>{const r=n.event,h="touch"===r.pointerType;if(e.isInVRExclusivePointerMode)return;if(n.type!==o.kD.POINTERMOVE&&-1===this.buttons.indexOf(r.button))return;const c=r.target;if(this._altKey=r.altKey,this._ctrlKey=r.ctrlKey,this._metaKey=r.metaKey,this._shiftKey=r.shiftKey,this._buttonsPressed=r.buttons,e.isPointerLock){const t=r.movementX,e=r.movementY;this.onTouch(null,t,e),this._pointA=null,this._pointB=null}else if(n.type!==o.kD.POINTERDOWN||-1!==this._currentActiveButton&&!h)if(n.type===o.kD.POINTERDOUBLETAP)this.onDoubleTap(r.pointerType);else if(n.type!==o.kD.POINTERUP||this._currentActiveButton!==r.button&&!h){if(n.type===o.kD.POINTERMOVE)if(t||r.preventDefault(),this._pointA&&null===this._pointB){const t=r.clientX-this._pointA.x,e=r.clientY-this._pointA.y;this.onTouch(this._pointA,t,e),this._pointA.x=r.clientX,this._pointA.y=r.clientY}else if(this._pointA&&this._pointB){const t=this._pointA.pointerId===r.pointerId?this._pointA:this._pointB;t.x=r.clientX,t.y=r.clientY;const e=this._pointA.x-this._pointB.x,i=this._pointA.y-this._pointB.y,o=e*e+i*i,h={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:r.pointerId,type:n.type};this.onMultiTouch(this._pointA,this._pointB,s,o,a,h),a=h,s=o}}else{try{null==c||c.releasePointerCapture(r.pointerId)}catch(t){}h||(this._pointB=null),e._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==r.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==r.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==s||a)&&(this.onMultiTouch(this._pointA,this._pointB,s,0,a,null),s=0,a=null),this._currentActiveButton=-1,this.onButtonUp(r),t||r.preventDefault()}else{try{null==c||c.setPointerCapture(r.pointerId)}catch(t){}null===this._pointA?this._pointA={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType}:null===this._pointB&&(this._pointB={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType}),-1!==this._currentActiveButton||h||(this._currentActiveButton=r.button),this.onButtonDown(r),t||(r.preventDefault(),i&&i.focus())}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,o.kD.POINTERDOWN|o.kD.POINTERUP|o.kD.POINTERMOVE|o.kD.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,s=0,a=null,this.onLostFocus()},this._contextMenuBind=this.onContextMenu.bind(this),i&&i.addEventListener("contextmenu",this._contextMenuBind,!1);const r=this.camera.getScene().getEngine().getHostWindow();r&&n.w1.RegisterTopRootEvents(r,[{name:"blur",handler:this._onLostFocus}])}detachControl(){if(this._onLostFocus){const t=this.camera.getScene().getEngine().getHostWindow();t&&n.w1.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._contextMenuBind){const t=this.camera.getScene().getEngine().getInputElement();t&&t.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(t){}onTouch(t,e,i){}onMultiTouch(t,e,i,s,a,n){}onContextMenu(t){t.preventDefault()}onButtonDown(t){}onButtonUp(t){}onLostFocus(){}}(0,s.gn)([(0,a.qC)()],r.prototype,"buttons",void 0)},4452:(t,e,i)=>{i.d(e,{v:()=>h});var s=i(3555),a=i(6786),n=i(4442),o=i(6233),r=i(4651);class h{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(t){t=r.w1.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((e=>{const i=e.event;if(!i.metaKey)if(e.type===o.OG.KEYDOWN)this._ctrlPressed=i.ctrlKey,this._altPressed=i.altKey,(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode))&&(-1===this._keys.indexOf(i.keyCode)&&this._keys.push(i.keyCode),i.preventDefault&&(t||i.preventDefault()));else if(-1!==this.keysUp.indexOf(i.keyCode)||-1!==this.keysDown.indexOf(i.keyCode)||-1!==this.keysLeft.indexOf(i.keyCode)||-1!==this.keysRight.indexOf(i.keyCode)||-1!==this.keysReset.indexOf(i.keyCode)){const e=this._keys.indexOf(i.keyCode);e>=0&&this._keys.splice(e,1),i.preventDefault&&(t||i.preventDefault())}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const t=this.camera;for(let e=0;e<this._keys.length;e++){const i=this._keys[e];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(i)&&t.useInputToRestoreState&&t.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,s.gn)([(0,a.qC)()],h.prototype,"keysUp",void 0),(0,s.gn)([(0,a.qC)()],h.prototype,"keysDown",void 0),(0,s.gn)([(0,a.qC)()],h.prototype,"keysLeft",void 0),(0,s.gn)([(0,a.qC)()],h.prototype,"keysRight",void 0),(0,s.gn)([(0,a.qC)()],h.prototype,"keysReset",void 0),(0,s.gn)([(0,a.qC)()],h.prototype,"panningSensibility",void 0),(0,s.gn)([(0,a.qC)()],h.prototype,"zoomingSensibility",void 0),(0,s.gn)([(0,a.qC)()],h.prototype,"useAltToZoom",void 0),(0,s.gn)([(0,a.qC)()],h.prototype,"angularSpeed",void 0),n.u.ArcRotateCameraKeyboardMoveInput=h},7366:(t,e,i)=>{i.d(e,{F:()=>p});var s=i(3555),a=i(6786),n=i(4442),o=i(147),r=i(8329),h=i(972),c=i(7786),l=i(6485),u=i(1865),d=i(4651);class p{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._inertialPanning=h.P.Zero()}_computeDeltaFromMouseWheelLegacyEvent(t,e){let i=0;const s=.01*t*this.wheelDeltaPercentage*e;return i=t>0?s/(1+this.wheelDeltaPercentage):s*(1+this.wheelDeltaPercentage),i}attachControl(t){t=d.w1.BackCompatCameraNoPreventDefault(arguments),this._wheel=e=>{if(e.type!==o.kD.POINTERWHEEL)return;const i=e.event;let s=0;const a=i.deltaMode===l.G.DOM_DELTA_LINE?40:1,n=-i.deltaY*a;if(this.customComputeDeltaFromMouseWheel)s=this.customComputeDeltaFromMouseWheel(n,this,i);else if(this.wheelDeltaPercentage){if(s=this._computeDeltaFromMouseWheelLegacyEvent(n,this.camera.radius),s>0){let t=this.camera.radius,e=this.camera.inertialRadiusOffset+s;for(let i=0;i<20&&Math.abs(e)>.001;i++)t-=e,e*=this.camera.inertia;t=u.R.Clamp(t,0,Number.MAX_VALUE),s=this._computeDeltaFromMouseWheelLegacyEvent(n,t)}}else s=n/(40*this.wheelPrecision);s&&(this.zoomToMouseLocation&&this._hitPlane?this._zoomToMouse(s):this.camera.inertialRadiusOffset+=s),i.preventDefault&&(t||i.preventDefault())},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,o.kD.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}detachControl(){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const t=this.camera;0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset&&(this._updateHitPlane(),t.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(t.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const t=this.camera,e=t.target.subtract(t.position);this._hitPlane=r.J.FromPositionAndNormal(t.target,e)}_getPosition(){var t;const e=this.camera,i=e.getScene(),s=i.createPickingRay(i.pointerX,i.pointerY,h.y3.Identity(),e,!1);let a=0;return this._hitPlane&&(a=null!==(t=s.intersectsPlane(this._hitPlane))&&void 0!==t?t:0),s.origin.addInPlace(s.direction.scaleInPlace(a))}_zoomToMouse(t){var e,i;const s=this.camera,a=1-s.inertia;if(s.lowerRadiusLimit){const i=null!==(e=s.lowerRadiusLimit)&&void 0!==e?e:0;s.radius-(s.inertialRadiusOffset+t)/a<i&&(t=(s.radius-i)*a-s.inertialRadiusOffset)}if(s.upperRadiusLimit){const e=null!==(i=s.upperRadiusLimit)&&void 0!==i?i:0;s.radius-(s.inertialRadiusOffset+t)/a>e&&(t=(s.radius-e)*a-s.inertialRadiusOffset)}const n=t/a/s.radius,o=this._getPosition(),r=h.jp.Vector3[6];o.subtractToRef(s.target,r),r.scaleInPlace(n),r.scaleInPlace(a),this._inertialPanning.addInPlace(r),s.inertialRadiusOffset+=t}_zeroIfClose(t){Math.abs(t.x)<c.kn&&(t.x=0),Math.abs(t.y)<c.kn&&(t.y=0),Math.abs(t.z)<c.kn&&(t.z=0)}}(0,s.gn)([(0,a.qC)()],p.prototype,"wheelPrecision",void 0),(0,s.gn)([(0,a.qC)()],p.prototype,"zoomToMouseLocation",void 0),(0,s.gn)([(0,a.qC)()],p.prototype,"wheelDeltaPercentage",void 0),n.u.ArcRotateCameraMouseWheelInput=p},5630:(t,e,i)=>{i.d(e,{H:()=>r});var s=i(3555),a=i(6786),n=i(4442),o=i(7632);class r extends o.O{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(t,e){if(0!==this.panningSensibility&&t&&e){const i=e.x-t.x,s=e.y-t.y;this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=s/this.panningSensibility}}_computePinchZoom(t,e){const i=this.camera.radius||r.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=i*Math.sqrt(t)/Math.sqrt(e):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(e-t)*i*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(e-t)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(t,e,i){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-e/this.panningSensibility,this.camera.inertialPanningY+=i/this.panningSensibility):(this.camera.inertialAlphaOffset-=e/this.angularSensibilityX,this.camera.inertialBetaOffset-=i/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(t,e,i,s,a,n){0===i&&null===a||0===s&&null===n||(this.multiTouchPanAndZoom?(this._computePinchZoom(i,s),this._computeMultiTouchPanning(a,n)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(s)-Math.sqrt(i))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(i,s),this._isPinching=!0):this._computeMultiTouchPanning(a,n)):this.multiTouchPanning?this._computeMultiTouchPanning(a,n):this.pinchZoom&&this._computePinchZoom(i,s))}onButtonDown(t){this._isPanClick=t.button===this.camera._panningMouseButton}onButtonUp(){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}r.MinimumRadiusForPinch=.001,(0,s.gn)([(0,a.qC)()],r.prototype,"buttons",void 0),(0,s.gn)([(0,a.qC)()],r.prototype,"angularSensibilityX",void 0),(0,s.gn)([(0,a.qC)()],r.prototype,"angularSensibilityY",void 0),(0,s.gn)([(0,a.qC)()],r.prototype,"pinchPrecision",void 0),(0,s.gn)([(0,a.qC)()],r.prototype,"pinchDeltaPercentage",void 0),(0,s.gn)([(0,a.qC)()],r.prototype,"useNaturalPinchZoom",void 0),(0,s.gn)([(0,a.qC)()],r.prototype,"pinchZoom",void 0),(0,s.gn)([(0,a.qC)()],r.prototype,"panningSensibility",void 0),(0,s.gn)([(0,a.qC)()],r.prototype,"multiTouchPanning",void 0),(0,s.gn)([(0,a.qC)()],r.prototype,"multiTouchPanAndZoom",void 0),n.u.ArcRotateCameraPointersInput=r},3579:(t,e,i)=>{i.d(e,{Y:()=>T});var s=i(3555),a=i(6786),n=i(4673),o=i(972),r=i(2528),h=i(3632),c=i(1480),l=i(3425),u=i(1193),d=i(5593),p=i(5753),_=i(4946),m=i(7786),g=i(4651);r.N.AddNodeConstructor("ArcRotateCamera",((t,e)=>()=>new T(t,0,0,1,o.P.Zero(),e)));class T extends p.C{constructor(t,e,i,s,a,r,h=!0){super(t,o.P.Zero(),r,h),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=o.P.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=o.FM.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this._viewMatrix=new o.y3,this.panningAxis=new o.P(1,1,0),this._transformedDirection=new o.P,this.mapPanning=!1,this.onMeshTargetChangedObservable=new n.y$,this.checkCollisions=!1,this.collisionRadius=new o.P(.5,.5,.5),this._previousPosition=o.P.Zero(),this._collisionVelocity=o.P.Zero(),this._newPosition=o.P.Zero(),this._computationVector=o.P.Zero(),this._onCollisionPositionChange=(t,e,i=null)=>{i?(this.setPosition(e),this.onCollide&&this.onCollide(i)):this._previousPosition.copyFrom(this._position);const s=Math.cos(this.alpha),a=Math.sin(this.alpha),n=Math.cos(this.beta);let o=Math.sin(this.beta);0===o&&(o=1e-4);const r=this._getTargetPosition();this._computationVector.copyFromFloats(this.radius*s*o,this.radius*n,this.radius*a*o),r.addToRef(this._computationVector,this._newPosition),this._position.copyFrom(this._newPosition);let h=this.upVector;this.allowUpsideDown&&this.beta<0&&(h=h.clone(),h=h.negate()),this._computeViewMatrix(this._position,r,h),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y),this._collisionTriggered=!1},this._target=o.P.Zero(),a&&this.setTarget(a),this.alpha=e,this.beta=i,this.radius=s,this.getViewMatrix(),this.inputs=new _.$(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}get target(){return this._target}set target(t){this.setTarget(t)}get targetHost(){return this._targetHost}set targetHost(t){t&&this.setTarget(t)}getTarget(){return this.target}get position(){return this._position}set position(t){this.setPosition(t)}set upVector(t){this._upToYMatrix||(this._yToUpMatrix=new o.y3,this._upToYMatrix=new o.y3,this._upVector=o.P.Zero()),t.normalize(),this._upVector.copyFrom(t),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){o.y3.RotationAlignToRef(o.P.UpReadOnly,this._upVector,this._yToUpMatrix),o.y3.RotationAlignToRef(this._upVector,o.P.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0}set angularSensibilityX(t){const e=this.inputs.attached.pointers;e&&(e.angularSensibilityX=t)}get angularSensibilityY(){const t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0}set angularSensibilityY(t){const e=this.inputs.attached.pointers;e&&(e.angularSensibilityY=t)}get pinchPrecision(){const t=this.inputs.attached.pointers;return t?t.pinchPrecision:0}set pinchPrecision(t){const e=this.inputs.attached.pointers;e&&(e.pinchPrecision=t)}get pinchDeltaPercentage(){const t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0}set pinchDeltaPercentage(t){const e=this.inputs.attached.pointers;e&&(e.pinchDeltaPercentage=t)}get useNaturalPinchZoom(){const t=this.inputs.attached.pointers;return!!t&&t.useNaturalPinchZoom}set useNaturalPinchZoom(t){const e=this.inputs.attached.pointers;e&&(e.useNaturalPinchZoom=t)}get panningSensibility(){const t=this.inputs.attached.pointers;return t?t.panningSensibility:0}set panningSensibility(t){const e=this.inputs.attached.pointers;e&&(e.panningSensibility=t)}get keysUp(){const t=this.inputs.attached.keyboard;return t?t.keysUp:[]}set keysUp(t){const e=this.inputs.attached.keyboard;e&&(e.keysUp=t)}get keysDown(){const t=this.inputs.attached.keyboard;return t?t.keysDown:[]}set keysDown(t){const e=this.inputs.attached.keyboard;e&&(e.keysDown=t)}get keysLeft(){const t=this.inputs.attached.keyboard;return t?t.keysLeft:[]}set keysLeft(t){const e=this.inputs.attached.keyboard;e&&(e.keysLeft=t)}get keysRight(){const t=this.inputs.attached.keyboard;return t?t.keysRight:[]}set keysRight(t){const e=this.inputs.attached.keyboard;e&&(e.keysRight=t)}get wheelPrecision(){const t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0}set wheelPrecision(t){const e=this.inputs.attached.mousewheel;e&&(e.wheelPrecision=t)}get zoomToMouseLocation(){const t=this.inputs.attached.mousewheel;return!!t&&t.zoomToMouseLocation}set zoomToMouseLocation(t){const e=this.inputs.attached.mousewheel;e&&(e.zoomToMouseLocation=t)}get wheelDeltaPercentage(){const t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0}set wheelDeltaPercentage(t){const e=this.inputs.attached.mousewheel;e&&(e.wheelDeltaPercentage=t)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new l.r,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new u.d,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new c.o,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}_initCache(){super._initCache(),this._cache._target=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=o.FM.Zero()}_updateCache(t){t||super._updateCache(),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const t=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(t)}return this._getLockedTargetPosition()||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset)}attachControl(t,e,i=!0,s=2){const a=arguments;e=g.w1.BackCompatCameraNoPreventDefault(a),this._useCtrlForPanning=i,this._panningMouseButton=s,"boolean"==typeof a[0]&&(a.length>1&&(this._useCtrlForPanning=a[1]),a.length>2&&(this._panningMouseButton=a[2])),this.inputs.attachElement(e),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}detachControl(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const t=this.invertRotation?-1:1;let e=this.inertialAlphaOffset;this.beta<=0&&(e*=-1),this.getScene().useRightHandedSystem&&(e*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this.alpha+=e*t,this.beta+=this.inertialBetaOffset*t,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<m.kn&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<m.kn&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*m.kn&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const t=new o.P(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);this._viewMatrix.invertToRef(this._cameraTransformMatrix),t.multiplyInPlace(this.panningAxis),o.P.TransformNormalToRef(t,this._cameraTransformMatrix,this._transformedDirection),!this.mapPanning&&this.panningAxis.y||(this._transformedDirection.y=0),this._targetHost||(this.panningDistanceLimit?(this._transformedDirection.addInPlace(this._target),o.P.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)):this._target.addInPlace(this._transformedDirection)),this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*m.kn&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*m.kn&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||o.P.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const t=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const e=Math.round((t-this.alpha)/(2*Math.PI));this.alpha+=2*e*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(t){this._position.equals(t)||(this._position.copyFrom(t),this.rebuildAnglesAndRadius())}setTarget(t,e=!1,i=!1,s=!1){var a;if(s=null!==(a=this.overrideCloneAlphaBetaRadius)&&void 0!==a?a:s,t.getBoundingInfo)this._targetBoundingCenter=e?t.getBoundingInfo().boundingBox.centerWorld.clone():null,t.computeWorldMatrix(),this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const e=t,s=this._getTargetPosition();if(s&&!i&&s.equals(e))return;this._targetHost=null,this._target=e,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}s||this.rebuildAnglesAndRadius()}_getViewMatrix(){const t=Math.cos(this.alpha),e=Math.sin(this.alpha),i=Math.cos(this.beta);let s=Math.sin(this.beta);0===s&&(s=1e-4),0===this.radius&&(this.radius=1e-4);const a=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*t*s,this.radius*i,this.radius*e*s),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||o.P.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),a.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){const t=this.getScene().collisionCoordinator;this._collider||(this._collider=t.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,t.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);let t=this.upVector;this.allowUpsideDown&&s<0&&(t=t.negate()),this._computeViewMatrix(this._position,a,t),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=a,this._viewMatrix}zoomOn(t,e=!1){t=t||this.getScene().meshes;const i=h.Kj.MinMax(t),s=o.P.Distance(i.min,i.max);this.radius=s*this.zoomOnFactor,this.focusOn({min:i.min,max:i.max,distance:s},e)}focusOn(t,e=!1){let i,s;if(void 0===t.min){const e=t||this.getScene().meshes;i=h.Kj.MinMax(e),s=o.P.Distance(i.min,i.max)}else i=t,s=t.distance;this._target=h.Kj.Center(i),e||(this.maxZ=2*s)}createRigCamera(t,e){let i=0;switch(this.cameraRigMode){case d.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.V.RIG_MODE_STEREOSCOPIC_INTERLACED:case d.V.RIG_MODE_VR:i=this._cameraRigParams.stereoHalfAngle*(0===e?1:-1);break;case d.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i=this._cameraRigParams.stereoHalfAngle*(0===e?-1:1)}const s=new T(t,this.alpha+i,this.beta,this.radius,this._target,this.getScene());return s._cameraRigParams={},s.isRigCamera=!0,s.rigParent=this,s.upVector=this.upVector,s.mode=this.mode,s.orthoLeft=this.orthoLeft,s.orthoRight=this.orthoRight,s.orthoBottom=this.orthoBottom,s.orthoTop=this.orthoTop,s}_updateRigCameras(){const t=this._rigCameras[0],e=this._rigCameras[1];switch(t.beta=e.beta=this.beta,this.cameraRigMode){case d.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.V.RIG_MODE_STEREOSCOPIC_INTERLACED:case d.V.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case d.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,s.gn)([(0,a.qC)()],T.prototype,"alpha",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"beta",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"radius",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,s.gn)([(0,a.hd)("target")],T.prototype,"_target",void 0),(0,s.gn)([(0,a.RR)("targetHost")],T.prototype,"_targetHost",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"inertialAlphaOffset",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"inertialBetaOffset",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"inertialRadiusOffset",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"lowerAlphaLimit",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"upperAlphaLimit",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"lowerBetaLimit",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"upperBetaLimit",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"lowerRadiusLimit",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"upperRadiusLimit",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"inertialPanningX",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"inertialPanningY",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"pinchToPanMaxDistance",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"panningDistanceLimit",void 0),(0,s.gn)([(0,a.hd)()],T.prototype,"panningOriginTarget",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"panningInertia",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"zoomToMouseLocation",null),(0,s.gn)([(0,a.qC)()],T.prototype,"zoomOnFactor",void 0),(0,s.gn)([(0,a.QC)()],T.prototype,"targetScreenOffset",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"allowUpsideDown",void 0),(0,s.gn)([(0,a.qC)()],T.prototype,"useInputToRestoreState",void 0)},4946:(t,e,i)=>{i.d(e,{$:()=>r});var s=i(5630),a=i(4452),n=i(7366),o=i(4442);class r extends o.p{constructor(t){super(t)}addMouseWheel(){return this.add(new n.F),this}addPointers(){return this.add(new s.H),this}addKeyboard(){return this.add(new a.v),this}}},4442:(t,e,i)=>{i.d(e,{p:()=>r,u:()=>o});var s=i(9288),a=i(6786),n=i(5593),o={};class r{constructor(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=()=>{}}add(t){const e=t.getSimpleName();this.attached[e]?s.Y.Warn("camera input of type "+e+" already exists on camera"):(this.attached[e]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl(this.noPreventDefault))}remove(t){for(const e in this.attached){const i=this.attached[e];i===t&&(i.detachControl(),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}}removeByType(t){for(const e in this.attached){const i=this.attached[e];i.getClassName()===t&&(i.detachControl(),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}}_addCheckInputs(t){const e=this.checkInputs;return()=>{e(),t()}}attachInput(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)}attachElement(t=!1){if(!this.attachedToElement){t=!n.V.ForceAttachControlToAlwaysPreventDefault&&t,this.attachedToElement=!0,this.noPreventDefault=t;for(const e in this.attached)this.attached[e].attachControl(t)}}detachElement(t=!1){for(const e in this.attached)this.attached[e].detachControl(),t&&(this.attached[e].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const t in this.attached){const e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(t){const e={};for(const t in this.attached){const i=this.attached[t],s=a.p4.Serialize(i);e[i.getClassName()]=s}t.inputsmgr=e}parse(t){const e=t.inputsmgr;if(e){this.clear();for(const t in e){const i=o[t];if(i){const s=e[t],n=a.p4.Parse((()=>new i),s,null);this.add(n)}}}else for(const e in this.attached){const i=o[this.attached[e].getClassName()];if(i){const s=a.p4.Parse((()=>new i),t,null);this.remove(this.attached[e]),this.add(s)}}}}},5753:(t,e,i)=>{i.d(e,{C:()=>c});var s=i(3555),a=i(6786),n=i(5593),o=i(972),r=i(7786),h=i(730);class c extends n.V{constructor(t,e,i,s=!0){super(t,e,i,s),this._tmpUpVector=o.P.Zero(),this._tmpTargetVector=o.P.Zero(),this.cameraDirection=new o.P(0,0,0),this.cameraRotation=new o.FM(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new o._f,this.rotation=new o.P(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=o.P.Zero(),this._initialFocalDistance=1,this._viewMatrix=o.y3.Zero(),this._camMatrix=o.y3.Zero(),this._cameraTransformMatrix=o.y3.Zero(),this._cameraRotationMatrix=o.y3.Zero(),this._referencePoint=new o.P(0,0,1),this._transformedReferencePoint=o.P.Zero(),this._defaultUp=o.P.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(t){this.getWorldMatrix();const e=this.getTarget().subtract(this.position);return e.normalize(),e.scaleInPlace(t),this.globalPosition.add(e)}_getLockedTargetPosition(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new o.P(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new o._f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(t){t||super._updateCache();const e=this._getLockedTargetPosition();e?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(e):this._cache.lockedTarget=e.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const t=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(t):!t)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const t=this.getEngine();return this.speed*Math.sqrt(t.getDeltaTime()/(100*t.getFps()))}setTarget(t){this.upVector.normalize(),this._initialFocalDistance=t.subtract(this.position).length(),this.position.z===t.z&&(this.position.z+=r.kn),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),o.y3.LookAtLHToRef(this.position,t,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const e=t.subtract(this.position);e.x>=0?this.rotation.y=-Math.atan(e.z/e.x)+Math.PI/2:this.rotation.y=-Math.atan(e.z/e.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&o._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(t){this.setTarget(t)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(o.jp.Matrix[0]),o.P.TransformNormalToRef(this.cameraDirection,o.jp.Matrix[0],o.jp.Vector3[0]),void this.position.addInPlace(o.jp.Vector3[0]);this.position.addInPlace(this.cameraDirection)}_checkInputs(){const t=this.invertRotation?-this.inverseRotationSpeed:1,e=this._decideIfNeedsToMove(),i=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(e&&this._updatePosition(),i){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*t,this.rotation.y+=this.cameraRotation.y*t,!this.noRotationConstraint){const t=1.570796;this.rotation.x>t&&(this.rotation.x=t),this.rotation.x<-t&&(this.rotation.x=-t)}this.rotationQuaternion&&this.rotation.lengthSquared()&&o._f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}e&&(Math.abs(this.cameraDirection.x)<this.speed*r.kn&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*r.kn&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*r.kn&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),i&&(Math.abs(this.cameraRotation.x)<this.speed*r.kn&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*r.kn&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):o.y3.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return o.P.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),o.P.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?h.RD.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(o._f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),h.RD.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(t,e,i){if(this.ignoreParentScaling){if(this.parent){const s=this.parent.getWorldMatrix();o.P.TransformCoordinatesToRef(t,s,this._globalPosition),o.P.TransformCoordinatesToRef(e,s,this._tmpTargetVector),o.P.TransformNormalToRef(i,s,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t),this._tmpTargetVector.copyFrom(e),this._tmpUpVector.copyFrom(i);this.getScene().useRightHandedSystem?o.y3.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):o.y3.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?o.y3.LookAtRHToRef(t,e,i,this._viewMatrix):o.y3.LookAtLHToRef(t,e,i,this._viewMatrix),this.parent){const t=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(t,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t)}createRigCamera(t,e){if(this.cameraRigMode!==n.V.RIG_MODE_NONE){const e=new c(t,this.position.clone(),this.getScene());return e.isRigCamera=!0,e.rigParent=this,this.cameraRigMode!==n.V.RIG_MODE_VR&&this.cameraRigMode!==n.V.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new o._f),e._cameraRigParams={},e.rotationQuaternion=new o._f),e.mode=this.mode,e.orthoLeft=this.orthoLeft,e.orthoRight=this.orthoRight,e.orthoTop=this.orthoTop,e.orthoBottom=this.orthoBottom,e}return null}_updateRigCameras(){const t=this._rigCameras[0],e=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case n.V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case n.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case n.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case n.V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case n.V.RIG_MODE_STEREOSCOPIC_INTERLACED:{const i=this.cameraRigMode===n.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,s=this.cameraRigMode===n.V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*i,t),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*s,e);break}case n.V.RIG_MODE_VR:t.rotationQuaternion?(t.rotationQuaternion.copyFrom(this.rotationQuaternion),e.rotationQuaternion.copyFrom(this.rotationQuaternion)):(t.rotation.copyFrom(this.rotation),e.rotation.copyFrom(this.rotation)),t.position.copyFrom(this.position),e.position.copyFrom(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(t,e){this.getTarget().subtractToRef(this.position,c._TargetFocalPoint),c._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const i=c._TargetFocalPoint.addInPlace(this.position);o.y3.TranslationToRef(-i.x,-i.y,-i.z,c._TargetTransformMatrix),c._TargetTransformMatrix.multiplyToRef(o.y3.RotationAxis(e.upVector,t),c._RigCamTransformMatrix),o.y3.TranslationToRef(i.x,i.y,i.z,c._TargetTransformMatrix),c._RigCamTransformMatrix.multiplyToRef(c._TargetTransformMatrix,c._RigCamTransformMatrix),o.P.TransformCoordinatesToRef(this.position,c._RigCamTransformMatrix,e.position),e.setTarget(i)}getClassName(){return"TargetCamera"}}c._RigCamTransformMatrix=new o.y3,c._TargetTransformMatrix=new o.y3,c._TargetFocalPoint=new o.P,(0,s.gn)([(0,a.hd)()],c.prototype,"rotation",void 0),(0,s.gn)([(0,a.qC)()],c.prototype,"speed",void 0),(0,s.gn)([(0,a.RR)("lockedTargetId")],c.prototype,"lockedTarget",void 0)},5046:(t,e,i)=>{i.d(e,{_:()=>u});var s=i(3555),a=i(6786),n=i(972),o=i(9859),r=i(2528),h=i(3873),c=i(9827),l=i(7026);class u extends r.N{constructor(t,e){super(t,e),this.diffuse=new o.Wo(1,1,1),this.specular=new o.Wo(1,1,1),this.falloffType=u.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=u.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new h.M(this.getScene().getEngine(),void 0,void 0,t),this._buildUniformLayout(),this.includedOnlyMeshes=new Array,this.excludedMeshes=new Array,this._resyncMeshes()}get range(){return this._range}set range(t){this._range=t,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(t){this._intensityMode=t,this._computePhotometricScale()}get radius(){return this._radius}set radius(t){this._radius=t,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(t){this._shadowEnabled!==t&&(this._shadowEnabled=t,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(t){this._includedOnlyMeshes=t,this._hookArrayForIncludedOnly(t)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(t){this._excludedMeshes=t,this._hookArrayForExcluded(t)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(t){this._excludeWithLayerMask=t,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(t){this._includeOnlyWithLayerMask=t,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(t){this._lightmapMode!==t&&(this._lightmapMode=t,this._markMeshesAsLightDirty())}transferTexturesToEffect(t,e){return this}_bindLight(t,e,i,s,a=!0){const n=t.toString();let r=!1;if(this._uniformBuffer.bindToEffect(i,"Light"+n),this._renderId!==e.getRenderId()||this._lastUseSpecular!==s||!this._uniformBuffer.useUbo){this._renderId=e.getRenderId(),this._lastUseSpecular=s;const t=this.getScaledIntensity();this.transferToEffect(i,n),this.diffuse.scaleToRef(t,o.zZ.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",o.zZ.Color3[0],this.range,n),s&&(this.specular.scaleToRef(t,o.zZ.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",o.zZ.Color3[1],this.radius,n)),r=!0}if(this.transferTexturesToEffect(i,n),e.shadowsEnabled&&this.shadowEnabled&&a){const t=this.getShadowGenerator();t&&(t.bindShadowLight(n,i),r=!0)}r?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(t){let e="Name: "+this.name;if(e+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let i=0;i<this.animations.length;i++)e+=", animation[0]: "+this.animations[i].toString(t);return e}_syncParentEnabledState(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}setEnabled(t){super.setEnabled(t),this._resyncMeshes()}getShadowGenerator(){return this._shadowGenerator}getAbsolutePosition(){return n.P.Zero()}canAffectMesh(t){return!(t&&(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(t)||this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(t)||0!==this.includeOnlyWithLayerMask&&0==(this.includeOnlyWithLayerMask&t.layerMask)||0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&t.layerMask))}dispose(t,e=!1){if(this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this),this._parentContainer){const t=this._parentContainer.lights.indexOf(this);t>-1&&this._parentContainer.lights.splice(t,1),this._parentContainer=null}for(const t of this.getScene().meshes)t._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(t,e)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.intensity}clone(t,e=null){const i=u.GetConstructorFromName(this.getTypeID(),t,this.getScene());if(!i)return null;const s=a.p4.Clone(i,this);return t&&(s.name=t),e&&(s.parent=e),s.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(s),s}serialize(){const t=a.p4.Serialize(this);return t.uniqueId=this.uniqueId,t.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(t),this.excludedMeshes.length>0&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach((e=>{t.excludedMeshesIds.push(e.id)}))),this.includedOnlyMeshes.length>0&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((e=>{t.includedOnlyMeshesIds.push(e.id)}))),a.p4.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.isEnabled=this.isEnabled(),t}static GetConstructorFromName(t,e,i){return r.N.Construct("Light_Type_"+t,e,i)||null}static Parse(t,e){const i=u.GetConstructorFromName(t.type,t.name,e);if(!i)return null;const s=a.p4.Parse(i,t,e);if(t.excludedMeshesIds&&(s._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(s._includedOnlyMeshesIds=t.includedOnlyMeshesIds),void 0!==t.parentId&&(s._waitingParentId=t.parentId),void 0!==t.parentInstanceIndex&&(s._waitingParentInstanceIndex=t.parentInstanceIndex),void 0!==t.falloffType&&(s.falloffType=t.falloffType),void 0!==t.lightmapMode&&(s.lightmapMode=t.lightmapMode),t.animations){for(let e=0;e<t.animations.length;e++){const i=t.animations[e],a=(0,c.q)("BABYLON.Animation");a&&s.animations.push(a.Parse(i))}r.N.ParseAnimationRanges(s,t,e)}return t.autoAnimate&&e.beginAnimation(s,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),void 0!==t.isEnabled&&s.setEnabled(t.isEnabled),s}_hookArrayForExcluded(t){const e=t.push;t.push=(...i)=>{const s=e.apply(t,i);for(const t of i)t._resyncLightSource(this);return s};const i=t.splice;t.splice=(e,s)=>{const a=i.apply(t,[e,s]);for(const t of a)t._resyncLightSource(this);return a};for(const e of t)e._resyncLightSource(this)}_hookArrayForIncludedOnly(t){const e=t.push;t.push=(...i)=>{const s=e.apply(t,i);return this._resyncMeshes(),s};const i=t.splice;t.splice=(e,s)=>{const a=i.apply(t,[e,s]);return this._resyncMeshes(),a},this._resyncMeshes()}_resyncMeshes(){for(const t of this.getScene().meshes)t._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const t of this.getScene().meshes)-1!==t.lightSources.indexOf(this)&&t._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}_getPhotometricScale(){let t=0;const e=this.getTypeID();let i=this.intensityMode;switch(i===u.INTENSITYMODE_AUTOMATIC&&(i=e===u.LIGHTTYPEID_DIRECTIONALLIGHT?u.INTENSITYMODE_ILLUMINANCE:u.INTENSITYMODE_LUMINOUSINTENSITY),e){case u.LIGHTTYPEID_POINTLIGHT:case u.LIGHTTYPEID_SPOTLIGHT:switch(i){case u.INTENSITYMODE_LUMINOUSPOWER:t=1/(4*Math.PI);break;case u.INTENSITYMODE_LUMINOUSINTENSITY:t=1;break;case u.INTENSITYMODE_LUMINANCE:t=this.radius*this.radius}break;case u.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case u.INTENSITYMODE_ILLUMINANCE:t=1;break;case u.INTENSITYMODE_LUMINANCE:{let e=this.radius;e=Math.max(e,.001),t=2*Math.PI*(1-Math.cos(e));break}}break;case u.LIGHTTYPEID_HEMISPHERICLIGHT:t=1}return t}_reorderLightsInScene(){const t=this.getScene();0!=this._renderPriority&&(t.requireLightSorting=!0),this.getScene().sortLightsByPriority()}}u.FALLOFF_DEFAULT=l.m.FALLOFF_DEFAULT,u.FALLOFF_PHYSICAL=l.m.FALLOFF_PHYSICAL,u.FALLOFF_GLTF=l.m.FALLOFF_GLTF,u.FALLOFF_STANDARD=l.m.FALLOFF_STANDARD,u.LIGHTMAP_DEFAULT=l.m.LIGHTMAP_DEFAULT,u.LIGHTMAP_SPECULAR=l.m.LIGHTMAP_SPECULAR,u.LIGHTMAP_SHADOWSONLY=l.m.LIGHTMAP_SHADOWSONLY,u.INTENSITYMODE_AUTOMATIC=l.m.INTENSITYMODE_AUTOMATIC,u.INTENSITYMODE_LUMINOUSPOWER=l.m.INTENSITYMODE_LUMINOUSPOWER,u.INTENSITYMODE_LUMINOUSINTENSITY=l.m.INTENSITYMODE_LUMINOUSINTENSITY,u.INTENSITYMODE_ILLUMINANCE=l.m.INTENSITYMODE_ILLUMINANCE,u.INTENSITYMODE_LUMINANCE=l.m.INTENSITYMODE_LUMINANCE,u.LIGHTTYPEID_POINTLIGHT=l.m.LIGHTTYPEID_POINTLIGHT,u.LIGHTTYPEID_DIRECTIONALLIGHT=l.m.LIGHTTYPEID_DIRECTIONALLIGHT,u.LIGHTTYPEID_SPOTLIGHT=l.m.LIGHTTYPEID_SPOTLIGHT,u.LIGHTTYPEID_HEMISPHERICLIGHT=l.m.LIGHTTYPEID_HEMISPHERICLIGHT,(0,s.gn)([(0,a.n9)()],u.prototype,"diffuse",void 0),(0,s.gn)([(0,a.n9)()],u.prototype,"specular",void 0),(0,s.gn)([(0,a.qC)()],u.prototype,"falloffType",void 0),(0,s.gn)([(0,a.qC)()],u.prototype,"intensity",void 0),(0,s.gn)([(0,a.qC)()],u.prototype,"range",null),(0,s.gn)([(0,a.qC)()],u.prototype,"intensityMode",null),(0,s.gn)([(0,a.qC)()],u.prototype,"radius",null),(0,s.gn)([(0,a.qC)()],u.prototype,"_renderPriority",void 0),(0,s.gn)([(0,a.wz)("_reorderLightsInScene")],u.prototype,"renderPriority",void 0),(0,s.gn)([(0,a.qC)("shadowEnabled")],u.prototype,"_shadowEnabled",void 0),(0,s.gn)([(0,a.qC)("excludeWithLayerMask")],u.prototype,"_excludeWithLayerMask",void 0),(0,s.gn)([(0,a.qC)("includeOnlyWithLayerMask")],u.prototype,"_includeOnlyWithLayerMask",void 0),(0,s.gn)([(0,a.qC)("lightmapMode")],u.prototype,"_lightmapMode",void 0)}}]);
//# sourceMappingURL=530.babylonBundle.js.map